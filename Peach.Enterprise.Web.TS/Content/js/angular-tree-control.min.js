(function(n){"use strict";n.module("treeControl",[]).directive("treecontrol",["$compile",function(t){function r(n,t){return n?t?'class="'+n+'"':n:""}function i(n,t,i){n.hasOwnProperty(t)||(n[t]=i)}return{restrict:"EA",require:"treecontrol",transclude:!0,scope:{treeModel:"=",selectedNode:"=?",expandedNodes:"=?",onSelection:"&",onNodeToggle:"&",options:"=?",orderBy:"@",reverseOrder:"@"},controller:["$scope",function(u){function o(n){return!n[u.options.nodeChildren]||n[u.options.nodeChildren].length===0}function s(t,i){return t===undefined||i===undefined?!1:(t=n.copy(t),t[u.options.nodeChildren]=[],i=n.copy(i),i[u.options.nodeChildren]=[],n.equals(t,i))}var f,e;for(u.options=u.options||{},i(u.options,"nodeChildren","children"),i(u.options,"dirSelectable","true"),i(u.options,"injectClasses",{}),i(u.options.injectClasses,"ul",""),i(u.options.injectClasses,"li",""),i(u.options.injectClasses,"liSelected",""),i(u.options.injectClasses,"iExpanded",""),i(u.options.injectClasses,"iCollapsed",""),i(u.options.injectClasses,"iLeaf",""),i(u.options.injectClasses,"label",""),i(u.options.injectClasses,"labelSelected",""),i(u.options,"equality",s),i(u.options,"isLeaf",o),u.expandedNodes=u.expandedNodes||[],u.expandedNodesMap={},f=0;f<u.expandedNodes.length;f++)u.expandedNodesMap[""+f]=u.expandedNodes[f];return u.parentScopeOfTree=u.$parent,u.headClass=function(n){var i=r(u.options.injectClasses.liSelected,!1),t="";return(i&&this.node==u.selectedNode&&(t=" "+i),u.options.isLeaf(n))?"tree-leaf"+t:u.expandedNodesMap[this.$id]?"tree-expanded"+t:"tree-collapsed"+t},u.iBranchClass=function(){return u.expandedNodesMap[this.$id]?r(u.options.injectClasses.iExpanded):r(u.options.injectClasses.iCollapsed)},u.nodeExpanded=function(){return!!u.expandedNodesMap[this.$id]},u.selectNodeHead=function(){var i=u.expandedNodesMap[this.$id]===undefined,t,n;if(u.expandedNodesMap[this.$id]=i?this.node:undefined,i)u.expandedNodes.push(this.node);else{for(n=0;n<u.expandedNodes.length&&!t;n++)u.options.equality(u.expandedNodes[n],this.node)&&(t=n);t!=undefined&&u.expandedNodes.splice(t,1)}if(u.onNodeToggle)u.onNodeToggle({node:this.node,expanded:i})},u.selectNodeLabel=function(n){if(n[u.options.nodeChildren]&&n[u.options.nodeChildren].length>0&&!u.options.dirSelectable)this.selectNodeHead();else if(u.selectedNode!=n&&(u.selectedNode=n,u.onSelection))u.onSelection({node:n})},u.selectedClass=function(){var n=r(u.options.injectClasses.labelSelected,!1),t="";return n&&this.node==u.selectedNode&&(t=" "+n),this.node==u.selectedNode?"tree-selected"+t:""},e="<ul "+r(u.options.injectClasses.ul,!0)+'><li ng-repeat="node in node.'+u.options.nodeChildren+' | orderBy:orderBy:reverseOrder" ng-class="headClass(node)" '+r(u.options.injectClasses.li,!0)+'><i class="tree-branch-head" ng-class="iBranchClass()" ng-click="selectNodeHead(node)"><\/i><i class="tree-leaf-head '+r(u.options.injectClasses.iLeaf,!1)+'"><\/i><div class="tree-label '+r(u.options.injectClasses.label,!1)+'" ng-class="selectedClass()" ng-click="selectNodeLabel(node)" tree-transclude><\/div><treeitem ng-if="nodeExpanded()"><\/treeitem><\/li><\/ul>',{template:t(e)}}],compile:function(t,i,r){return function(t,i,u,f){t.$watch("treeModel",function(i){if(n.isArray(i)){if(n.isDefined(t.node)&&n.equals(t.node[t.options.nodeChildren],i))return;t.node={};t.node[t.options.nodeChildren]=i}else{if(n.equals(t.node,i))return;t.node=i}});t.$watchCollection("expandedNodes",function(r){var e=0,u={},o=i.find("li"),f=[];n.forEach(o,function(t){var i=n.element(t),r=i.scope();f.push(r)});n.forEach(r,function(n){for(var i,r=!1,o=0;o<f.length&&!r;o++)i=f[o],t.options.equality(n,i.node)&&(u[i.$id]=i.node,r=!0);r||(u[e++]=n)});t.expandedNodesMap=u});f.template(t,function(n){i.html("").append(n)});t.$treeTransclude=r}}}}]).directive("treeitem",function(){return{restrict:"E",require:"^treecontrol",link:function(n,t,i,r){r.template(n,function(n){t.html("").append(n)})}}}).directive("treeTransclude",function(){return{link:function(t,i){t.options.isLeaf(t.node)||n.forEach(t.expandedNodesMap,function(n,i){t.options.equality(n,t.node)&&(t.expandedNodesMap[t.$id]=t.node,t.expandedNodesMap[i]=undefined)});t.options.equality(t.node,t.selectedNode)&&t.selectNodeLabel(t.node);t.transcludeScope=t.parentScopeOfTree.$new();t.transcludeScope.node=t.node;t.$on("$destroy",function(){t.transcludeScope.$destroy()});t.$treeTransclude(t.transcludeScope,function(n){i.empty();i.append(n)})}}})})(angular);
/*
//# sourceMappingURL=angular-tree-control.min.js.map
*/