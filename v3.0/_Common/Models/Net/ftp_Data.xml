<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://peachfuzzer.com/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://peachfuzzer.com/2012/Peach ../peach.xsd"
       author="Deja Vu Security, LLC" description="File Transfer Protocol PIT DataModels" version="0.0.2">
	<!-- Copyright (c) Deja Vu Security, LLC 2013 -->

	<PythonPath path="##Path##/_Common/Models/Net/"/>
	<Import import="ftpFixup" />

	<!-- Helper Models -->
	<DataModel name="ArgBlock">
		<String name="Break" token="true" value=" "/>
		<String name="Argument"/>
	</DataModel>

	<DataModel name="OneLineExplain">
		<String name="Break" token="true" value=" "/>
		<String name="Explaination"/>
		<String name="Terminator" token="true" value="\r\n"/>
	</DataModel>

	<DataModel name="MultiLineExplain">
		<String name="Break" token="true" value="-"/>
		<Block name="ExplainLineBlock">
			<String name="Explaination"/>
			<String name="Terminator" token="true" value="\r\n"/>
		</Block>
		<String name="LastLineMarker" token="true">
			<Fixup class="CopyValue">
				<Param name="ref" value="Status"/>
			</Fixup>
		</String>
		<String name="ExplainationLastLine"/>
		<String name="Terminator" token="true" value="\r\n"/>
	</DataModel>

	<DataModel name="MultiLineExplainV2">
		<Block name="FirstLine" ref="OneLineExplain">
			<String name="Break" token="true" value="-"/>
		</Block>
		<Block name="ExplainLineBlock" minOccurs="0">
			<String name="ContinuationMarker" length="3" >
				<Fixup class="CopyValue">
					<Param name="ref" value="Status"/>
				</Fixup>
			</String>
			<Block name="ContiuationLines" ref="OneLineExplain">
				<String name="Break" token="true" value="-"/>
			</Block>
		</Block>
		<String name="LastLineMarker" length="3">
			<Fixup class="CopyValue">
				<Param name="ref" value="Status"/>
			</Fixup>
		</String>
		<Block name="LastLine" ref="OneLineExplain"/>
	</DataModel>

	<!-- FTP Server Replies -->
	<DataModel name="ResponseTemplate">
		<String name="Status" length="3"/>
		<Choice name="LineModes">
			<Block name="OneLine" ref="OneLineExplain"/>
			<!-- <Block name="MultiLine" ref="MultiLineExplain"/> -->
			<Block name="MultiLine2" ref="MultiLineExplainV2"/>
		</Choice>
	</DataModel>

	<!-- 4.2.  FTP REPLIES -->
	<DataModel name="ServerOk" ref="ResponseTemplate">
		<String name="Status" value="200" token="true"/>
	</DataModel>

	<DataModel name="ServerReadyForUser" ref="ResponseTemplate">
		<String name="Status" value="220" token="true"/>
	</DataModel>

	<DataModel name="DirCreated" ref="ResponseTemplate">
		<String name="Status" value="257" length="3"/>
	</DataModel>

	<DataModel name="DirDeleted" ref="ResponseTemplate">
		<String name="Status" value="250" token="true"/>
	</DataModel>

	<DataModel name="ServerUserNeedsPass" ref="ResponseTemplate">
		<String name="Status" value="331" token="true"/>
	</DataModel>

	<DataModel name="ServerSendDirectory" ref="ResponseTemplate">
		<String name="Status" value="150" token="true"/>
	</DataModel>

	<DataModel name="ServerDirectorySendOk" ref="ResponseTemplate">
		<String name="Status" value="226" token="true"/>
	</DataModel>

	<DataModel name="DirectoryData">
		<String name="Data" value="Desktop\r\nDocuments\r\nDownloads\r\nSecrets\r\nPublic\r\nPictures\r\n"/>
		<String name="Data2" value="file1.png\r\nfile2.xml\r\nmy_ssn.txt\r\nVideos\r\n"/>
	</DataModel>

	<DataModel name="DirectoryList">
		<String name="Data" value="-rw-------    1 1000     1000           11 Apr 29 16:55 2\r\ndrwxr-xr-x    2 1000     1000         4096 Oct 11  2012 Desktop\r\ndrwxr-xr-x    2 1000     1000         4096 Oct 11  2012 Documents\r\ndrwxr-xr-x    2 1000     1000         4096 Oct 11  2012 clients.sh\r\ndrwxr-xr-x    2 1000     1000         4096 Oct 11  2012 File.txt\r\n"/>
	</DataModel>

	<DataModel name="FileData">
		<Blob name="Data" valueType="hex" value="7B 5C 72 74 66 31 5C 61 6E 73 69 5C 61 6E 73 69 63 70 67 31 32 35 32 5C 64 65 66 66 30 5C 64 65 66 6C 61 6E 67 31 30 33 33 7B 5C 66 6F 6E 74 74 62 6C 7B 5C 66 30 5C 66 6E 69 6C 5C 66 63 68 61 72 73 65 74 30 20 43 61 6C 69 62 72 69 3B 7D 7D 0D 0A 7B 5C 2A 5C 67 65 6E 65 72 61 74 6F 72 20 4D 73 66 74 65 64 69 74 20 35 2E 34 31 2E 32 31 2E 32 35 31 30 3B 7D 5C 76 69 65 77 6B 69 6E 64 34 5C 75 63 31 5C 70 61 72 64 5C 73 61 32 30 30 5C 73 6C 32 37 36 5C 73 6C 6D 75 6C 74 31 5C 6C 61 6E 67 39 5C 66 30 5C 66 73 32 32 20 57 68 6F 61 2E 20 44 5C 27 65 39 6A 5C 27 65 30 20 76 75 2E 5C 70 61 72 0D 0A 7D 0D 0A 00"/>
	</DataModel>

	<DataModel name="ServerLoggedIn" ref="ResponseTemplate">
		<String name="Status" value="230" token="true"/>
	</DataModel>

	<DataModel name="ServerQuit" ref="ResponseTemplate">
		<String name="Status" value="221" token="true"/>
	</DataModel>

	<!-- FTP Client Commands -->
	<DataModel name="RequestTemplate">
		<String name="Command" length="4"/>
		<Block name="ReqArgBlock" ref="ArgBlock" minOccurs="0"/>
		<String name="Terminator" length="2" mutable="false" token="true" value="\r\n"/>
	</DataModel>

	<!-- FTP Data Catch -->
	<DataModel name="FTPDataCatch">
		<Blob name="Data"/>
	</DataModel>


	<!-- 4.1.  FTP COMMANDS -->

	<!--      USER <SP> <username> <CRLF> -->
	<DataModel name="USER" ref="RequestTemplate">
		<String name="Command" value="USER" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock">
			<String name="Argument" value="##FtpUser##"/>
		</Block>
	</DataModel>

  <!--      PASS <SP> <password> <CRLF> -->
	<DataModel name="PASS" ref="RequestTemplate">
		<String name="Command" value="PASS" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock">
			<String name="Argument" value="##FtpPass##"/>
		</Block>
	</DataModel>

	<DataModel name="PortRequest" ref="RequestTemplate">
		<String name="Command" value="PORT" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock">
			<String name="Argument" value="##SourceIPv4##,##DataPort##">
				<Fixup class="ScriptFixup">
					<Param name="class" value="ftpFixup.FtpPortToHexFixup"/>
					<Param name="ref" value="Argument" />
				</Fixup>
			</String>
		</Block>
	</DataModel>

	<DataModel name="PasvRequest" ref="RequestTemplate">
		<String name="Command" value="PASV" token="true"/>
	</DataModel>

  <!--      ACCT <SP> <account information> <CRLF> -->
	<DataModel name="ACCT" ref="RequestTemplate">
		<String name="Command" value="ACCT" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock"/>
	</DataModel>

  <!--      REIN <CRLF> -->
	<DataModel name="REIN" ref="RequestTemplate">
		<String name="Command" value="REIN" token="true"/>
	</DataModel>

  <!--      QUIT <CRLF> -->
	<DataModel name="QUIT" ref="RequestTemplate">
		<String name="Command" value="QUIT" token="true"/>
	</DataModel>

  <!--      PORT <SP> <Host-port> <CRLF> -->
	<DataModel name="PORT" ref="RequestTemplate">
		<String name="Command" value="PORT" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock"/>
	</DataModel>

  <!--      PASV <CRLF> -->
	<DataModel name="PASV" ref="RequestTemplate">
		<String name="Command" value="PASV" token="true"/>
	</DataModel>

  <!--      TYPE <SP> <type code> <CRLF> -->
	<DataModel name="TYPE" ref="RequestTemplate">
		<String name="Command" value="TYPE" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock"/>
	</DataModel>

  <!--      STRU <SP> <structure code> <CRLF> -->
	<DataModel name="STRU" ref="RequestTemplate">
		<String name="Command" value="STRU" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock"/>
	</DataModel>

  <!--      MODE <SP> <mode code> <CRLF> -->
	<DataModel name="MODE" ref="RequestTemplate">
		<String name="Command" value="MODE" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock"/>
	</DataModel>

  <!--      RETR <SP> <pathname> <CRLF> -->
	<DataModel name="RETR" ref="RequestTemplate">
		<String name="Command" value="RETR" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock"/>
	</DataModel>

  <!--      STOR <SP> <pathname> <CRLF> -->
	<DataModel name="STOR" ref="RequestTemplate">
		<String name="Command" value="STOR" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock"/>
	</DataModel>

  <!--      APPE <SP> <pathname> <CRLF> -->
	<DataModel name="APPE" ref="RequestTemplate">
		<String name="Command" value="APPE" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock"/>
	</DataModel>

  <!--      MLFL [<SP> <ident>] <CRLF> -->
	<DataModel name="MLFL" ref="RequestTemplate">
		<String name="Command" value="MLFL" token="true"/>
	</DataModel>

  <!--      MAIL [<SP> <ident>] <CRLF> -->
	<DataModel name="MAIL" ref="RequestTemplate">
		<String name="Command" value="MAIL" token="true"/>
	</DataModel>

  <!--      MSND [<SP> <ident>] <CRLF> -->
	<DataModel name="MSND" ref="RequestTemplate">
		<String name="Command" value="MSND" token="true"/>
	</DataModel>

  <!--      MSOM [<SP> <ident>] <CRLF> -->
	<DataModel name="MSOM" ref="RequestTemplate">
		<String name="Command" value="MSOM" token="true"/>
	</DataModel>

  <!--      MSAM [<SP> <ident>] <CRLF> -->
	<DataModel name="MSAM" ref="RequestTemplate">
		<String name="Command" value="MSAM" token="true"/>
	</DataModel>

  <!--      MRSQ [<SP> <scheme>] <CRLF> -->
	<DataModel name="MRSQ" ref="RequestTemplate">
		<String name="Command" value="MRSQ" token="true"/>
	</DataModel>

  <!--      MRCP <SP> <ident> <CRLF> -->
	<DataModel name="MRCP" ref="RequestTemplate">
		<String name="Command" value="MRCP" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock"/>
	</DataModel>

  <!--      ALLO <SP> <decimal integer> -->
  <!--          [<SP> R <SP> <decimal integer>] <CRLF> -->
	<DataModel name="ALLO" ref="RequestTemplate">
		<String name="Command" value="ALLO" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock"/>
	</DataModel>

  <!--      REST <SP> <marker> <CRLF> -->
	<DataModel name="REST" ref="RequestTemplate">
		<String name="Command" value="REST" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock"/>
	</DataModel>

  <!--      RNFR <SP> <pathname> <CRLF> -->
	<DataModel name="RNFR" ref="RequestTemplate">
		<String name="Command" value="RNFR" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock"/>
	</DataModel>

  <!--      RNTO <SP> <pathname> <CRLF> -->
	<DataModel name="RNTO" ref="RequestTemplate">
		<String name="Command" value="RNTO" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock"/>
	</DataModel>

  <!--      ABOR <CRLF> -->
	<DataModel name="ABOR" ref="RequestTemplate">
		<String name="Command" value="ABOR" token="true"/>
	</DataModel>

  <!--      DELE <SP> <pathname> <CRLF> -->
	<DataModel name="DELE" ref="RequestTemplate">
		<String name="Command" value="DELE" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock"/>
	</DataModel>

  <!--      CWD <SP> <pathname> <CRLF> -->
	<DataModel name="CWD" ref="RequestTemplate">
		<String name="Command" value="CWD" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock"/>
	</DataModel>

  <!--      LIST [<SP> <pathname>] <CRLF> -->
	<DataModel name="LIST" ref="RequestTemplate">
		<String name="Command" value="LIST" token="true"/>
	</DataModel>

  <!--      NLST [<SP> <pathname>] <CRLF> -->
	<DataModel name="NLST" ref="RequestTemplate">
		<String name="Command" value="NLST" token="true"/>
	</DataModel>

  <!--      SITE <SP> <string> <CRLF> -->
	<DataModel name="SITE" ref="RequestTemplate">
		<String name="Command" value="SITE" token="true"/>
		<Block name="ReqArgBlock" ref="ArgBlock"/>
	</DataModel>

  <!--      STAT [<SP> <pathname>] <CRLF> -->
	<DataModel name="STAT" ref="RequestTemplate">
		<String name="Command" value="STAT" token="true"/>
	</DataModel>

  <!--      HELP [<SP> <string>] <CRLF> -->
	<DataModel name="HELP" ref="RequestTemplate">
		<String name="Command" value="HELP" token="true"/>
	</DataModel>

  <!--      NOOP <CRLF> -->
	<DataModel name="NOOP" ref="RequestTemplate">
		<String name="Command" value="NOOP" token="true"/>
	</DataModel>

  <!--      CDUP - Change to Parent Directory -->
	<DataModel name="CDUP" ref="RequestTemplate">
		<String name="Command" value="CDUP" token="true"/>
	</DataModel>

  <!--      SMNT - Structure Mount -->
	<DataModel name="SMNT" ref="RequestTemplate">
		<String name="Command" value="SMNT" token="true"/>
	</DataModel>

  <!--      STOU - Store Unique -->
	<DataModel name="STOU" ref="RequestTemplate">
		<String name="Command" value="STOU" token="true"/>
	</DataModel>

  <!--      RMD - Remove Directory -->
	<DataModel name="RMD" ref="RequestTemplate">
		<Choice name="Command">
			<String name="RMD" value="RMD" token="true"/>
			<String name="XRMD" value="XRMD" token="true"/>
		</Choice>
		<Block name="ReqArgBlock" ref="ArgBlock">
			<String name="Argument" value="foobarbaz"/>
		</Block>
	</DataModel>

  <!--      MKD - Make Directory -->
	<DataModel name="MKD" ref="RequestTemplate">
		<Choice name="Command">
			<String name="MKD" value="MKD" token="true"/>
			<String name="XMKD" value="XMKD" token="true"/>
		</Choice>
		<Block name="ReqArgBlock" ref="ArgBlock">
			<String name="Argument" value="foobarbaz"/>
		</Block>
	</DataModel>

  <!--      PWD - Print Directory -->
	<DataModel name="PWD" ref="RequestTemplate">
		<Choice name="Command">
			<String name="PWD" value="PWD" token="true"/>
			<String name="XPWD" value="XPWD" token="true"/>
		</Choice>
	</DataModel>

  <!--      SYST - System -->
	<DataModel name="SYST" ref="RequestTemplate">
		<String name="Command" value="SYST" token="true"/>
	</DataModel>

	<!--      SYST - System -->
	<DataModel name="UNSU" ref="RequestTemplate">
	</DataModel>

	<!-- 4.1.  FTP COMMANDS -->
	<DataModel name="Request">
		<Choice>
			<Block name="QUITChoice" ref="QUIT" />
			<Block name="LISTChoice" ref="LIST" />
			<Block name="CWDChoice" ref="CWD" />
			<Block name="USERChoice" ref="USER" />
			<Block name="PASSChoice" ref="PASS" />
			<Block name="ACCTChoice" ref="ACCT" />
			<Block name="REINChoice" ref="REIN" />
			<Block name="PORTChoice" ref="PORT" />
			<Block name="PASVChoice" ref="PASV" />
			<Block name="TYPEChoice" ref="TYPE" />
			<Block name="STRUChoice" ref="STRU" />
			<Block name="MODEChoice" ref="MODE" />
			<Block name="RETRChoice" ref="RETR" />
			<Block name="STORChoice" ref="STOR" />
			<Block name="APPEChoice" ref="APPE" />
			<Block name="MLFLChoice" ref="MLFL" />
			<Block name="MAILChoice" ref="MAIL" />
			<Block name="MSNDChoice" ref="MSND" />
			<Block name="MSOMChoice" ref="MSOM" />
			<Block name="MSAMChoice" ref="MSAM" />
			<Block name="MRSQChoice" ref="MRSQ" />
			<Block name="MRCPChoice" ref="MRCP" />
			<Block name="ALLOChoice" ref="ALLO" />
			<Block name="RESTChoice" ref="REST" />
			<Block name="RNFRChoice" ref="RNFR" />
			<Block name="RNTOChoice" ref="RNTO" />
			<Block name="ABORChoice" ref="ABOR" />
			<Block name="DELEChoice" ref="DELE" />
			<Block name="NLSTChoice" ref="NLST" />
			<Block name="SITEChoice" ref="SITE" />
			<Block name="STATChoice" ref="STAT" />
			<Block name="HELPChoice" ref="HELP" />
			<Block name="NOOPChoice" ref="NOOP" />
			<Block name="CDUPChoice" ref="CDUP" />
			<Block name="SMNTChoice" ref="SMNT" />
			<Block name="STOUChoice" ref="STOU" />
			<Block name="RMDChoice" ref="RMD" />
			<Block name="MKDChoice" ref="MKD" />
			<Block name="PWDChoice" ref="PWD" />
			<Block name="SYSTChoice" ref="SYST" />
			<Block name="Unsupported" ref="UNSU"/>
			<Blob name="EmptyPacket" length="0"/>
		</Choice>
	</DataModel>


	<!-- 3.4.  TRANSMISSION MODES -->
	<!-- 3.4.1.  STREAM MODE -->
	<!-- 3.4.2.  BLOCK MODE -->
	<!-- 3.4.3.  COMPRESSED MODE  -->
</Peach>
<!--END-->
