<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://peachfuzzer.com/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://peachfuzzer.com/2012/Peach /peach/peach.xsd"
       author="Deja Vu Security, LLC" description="LDAPv3 Pit" version="0.0.2">
	<!-- Copyright (c) Deja Vu Security, LLC 2013 -->

	<Include ns="LDAP" src="file:##Path##/_Common/Models/Net/Ldap_State.xml"/>

	<Agent name="LocalAgent">
	    <Monitor name="Network" class="Pcap">
				<Param name="filter" value="tcp"/>
				<Param name="Device" value="##Interface##" />
	    </Monitor>
	</Agent>

	<Agent name="ServerAgent">
		<Monitor class="WindowsDebugger">
			<Param name="CommandLine" value="..\..\..\..\Downloads\LdapAdmin.exe ldap://##SourceIPv4##/"/>
			<Param name="NoCpuKill" value="true"/>
			<Param name="FaultOnEarlyExit" value="true"/>
			<Param name="WaitForExitTimeout" value="500"/>
			<Param name="StartOnCall" value="launchProgram"/>
		</Monitor>
	</Agent>

	<Test name="Default">
	    <Agent ref="LocalAgent" />
	    <StateModel ref="LDAP:Search"/>

			<Strategy class="##Strategy##"/>

	    <Publisher class="Tcp" name="tcp">
				<Param name="Host" value="##TargetIPv4##" />
				<Param name="Port" value="##TargetPort##" />
				<Param name="Timeout" value="10000"/>
	    </Publisher>

	    <Logger class="File">
			<Param name="Path" value="##LoggerPath##/Search" />
	    </Logger>
	</Test>

	<Test name="Server">
		<Agent ref="ServerAgent"/>

		<StateModel ref="LDAP:Server"/>

		<Strategy class="##Strategy##"/>

		<Publisher name="TcpHandler" class="TcpListener">
			<Param name="Interface" value="##SourceIPv4##" />
			<Param name="Port" value="##TargetPort##"/>
		</Publisher>

		<Logger class="File">
			<Param name="Path" value="##LoggerPath##/server"/>
		</Logger>
	</Test>

	<Test name="Add">
	    <Agent ref="LocalAgent" />
	    <StateModel ref="LDAP:Add"/>

			<Strategy class="##Strategy##"/>

	    <Publisher class="Tcp" name="tcp">
				<Param name="Host" value="##TargetIPv4##" />
				<Param name="Port" value="##TargetPort##" />
	    </Publisher>

	    <Logger class="File">
				<Param name="Path" value="##LoggerPath##/Add" />
	    </Logger>
	</Test>

	<Test name="Compare">
	    <Agent ref="LocalAgent" />
	    <StateModel ref="LDAP:Compare"/>

			<Strategy class="##Strategy##"/>

	    <Publisher class="Tcp" name="tcp">
				<Param name="Host" value="##TargetIPv4##" />
				<Param name="Port" value="##TargetPort##" />
	    </Publisher>

	    <Logger class="File">
				<Param name="Path" value="##LoggerPath##/Compare" />
	    </Logger>
	</Test>

	<Test name="Delete">
	    <Agent ref="LocalAgent" />
	    <StateModel ref="LDAP:Delete"/>

			<Strategy class="##Strategy##"/>

	    <Publisher class="Tcp" name="tcp">
				<Param name="Host" value="##TargetIPv4##" />
				<Param name="Port" value="##TargetPort##" />
	    </Publisher>

	    <Logger class="File">
				<Param name="Path" value="##LoggerPath##/Delete" />
	    </Logger>
	</Test>

	<Test name="ExtendOp">
	    <Agent ref="LocalAgent" />
	    <StateModel ref="LDAP:ExtendOp"/>

			<Strategy class="##Strategy##"/>

	    <Publisher class="Tcp" name="tcp">
				<Param name="Host" value="##TargetIPv4##" />
				<Param name="Port" value="##TargetPort##" />
	    </Publisher>

	    <Logger class="File">
				<Param name="Path" value="##LoggerPath##/ExtendOp" />
	    </Logger>
	</Test>
</Peach>
<!-- end -->
