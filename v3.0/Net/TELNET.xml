<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://peachfuzzer.com/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
			 xsi:schemaLocation="http://peachfuzzer.com/2012/Peach ../peach.xsd"
       author="Deja Vu Security, LLC" description="Telnet Command Protocol PIT" version="0.0.2">
  <!-- Copyright (c) Deja Vu Security, LLC 2014 -->
	
	<Include ns="TELNET" src="file:##Path##/_Common/Models/Net/TELNET_State.xml"/>
	
      <Agent name="TheAgent">
      </Agent> 
	
	<Agent name="Windows">
		<Monitor class="WindowsDebugger">
			<Param name="CommandLine" value="..\..\..\..\Downloads\##Program## telnet://##LocalIPv4##:##HostPort##" />
			<Param name="NoCpuKill" value="true" />
			<Param name="FaultOnEarlyExit" value="false" />
			<Param name="WaitForExitTimeout" value="250" />
			<Param name="StartOnCall" value="launchProgram" />
			<Param name="WaitForExitOnCall" value="exitProgram"/>
		</Monitor>
	</Agent>
	
    <Agent name="Linux">
        <Monitor class="LinuxCrashMonitor"/>

		<Monitor class="Process">
            <Param name="Executable" value="##Program##" />
            <Param name="Arguments" value="##LocalIPv4## ##HostPort##"/>
			<Param name="StartOnCall" value="launchProgram" />
			<Param name="WaitForExitOnCall" value="exitProgram"/>
		</Monitor>
    </Agent>

    <!-- Client Test-->
    <Test name="Default">
		<StateModel ref="TELNET:AgentToHost"/>
		
		<Agent ref="TheAgent"/>
		
		<Publisher class="Tcp" name="TcpHandler">
			<Param name="Host" value="##TargetIPv4##"/>
			<Param name="Port" value="##TargetPort##"/>
			<Param name="Timeout" value="1000"/>
		</Publisher>
		
		<Strategy class="##Strategy##"/>
		
		<Logger class="File" >
			<Param name="Path" value="##LoggerPath##"/>
		</Logger>	
    </Test>

    <!-- Server Test -->
    <Test name="Server">
		<StateModel ref="TELNET:HostToAgent"/>
		
		<Agent ref="##Agent##"/>
		
		<Publisher name="TcpHandler" class="TcpListener">
			<Param name="Interface" value="##LocalIPv4##" />
			<Param name="Port" value="##HostPort##" />
		</Publisher>
		
		<Strategy class="##Strategy##"/>
		
		<Logger class="File" >
			<Param name="Path" value="##LoggerPath##"/>
        </Logger>	
    </Test>
</Peach>
<!--END-->
