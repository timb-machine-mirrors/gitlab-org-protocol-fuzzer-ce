<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://peachfuzzer.com/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
			 xsi:schemaLocation="http://peachfuzzer.com/2012/Peach ../peach.xsd"
       author="Deja Vu Security, LLC" description="File  Protocol PIT" version="0.0.2">
  <!-- Copyright (c) Deja Vu Security, LLC 2013 -->

	<Include ns="FTP" src="file:##Path##/_Common/Models/Net/ftp_State.xml"/>

	<Agent name="LinServerAgent">
    <Monitor class="LinuxCrashMonitor"/>

    <Monitor class="Process">
      <Param name="Executable" value="##Program##" />
      <Param name="Arguments" value="##SourceIPv4##" />
      <Param name="StartOnCall" value="launchProgram"/>
      <Param name="WaitForExitOnCall" value="exitProgram"/>
    </Monitor>
	</Agent>

  <Agent name="OsxServerAgent">
    <Monitor class="Process">
      <Param name="Executable" value="##Program##" />
      <Param name="Arguments" value="##SourceIPv4##" />
      <Param name="StartOnCall" value="launchProgram"/>
      <Param name="WaitForExitOnCall" value="exitProgram"/>
    </Monitor>
  </Agent>

	<Agent name="WinServerAgent">
		<Monitor class="Process">
      <Param name="Executable" value="##Program##" />
      <Param name="StartOnCall" value="launchProgram"/>
      <Param name="WaitForExitOnCall" value="exitProgram"/>
    </Monitor>
	</Agent>

	<!-- Client test case -->
	<Test name="Default">
		<StateModel ref="FTP:AgentToHost"/>

		<Publisher class="Tcp" name="CommandPublisher">
			<Param name="Host" value="##TargetIPv4##"/>
			<Param name="Port" value="##TargetPort##"/>
      <Param name="Timeout" value="10000"/>
		</Publisher>

    <!-- Used by client state for data port in active mode -->
    <Publisher name="DataListner" class="TcpListener">
      <Param name="Interface" value="##SourceIPv4##"/>
      <Param name="Port" value="##DataPort##"/>
      <Param name="AcceptTimeout" value="10000"/>
    </Publisher>

		<Strategy class="##Strategy##"/>
		<Logger class="File" >
			<Param name="Path" value="##LoggerPath##"/>
		</Logger>
	</Test>

	<!--Server side test-->
	<Test name="Server">

		<!--<Agent ref="WinServerAgent" platform="windows"/>-->
		<Agent ref="LinServerAgent" platform="linux"/>
    <Agent ref="OsxServerAgent" platform="osx"/>

		<StateModel ref="FTP:HostToAgent"/>

		<Publisher name="CommandPublisher" class="TcpListener">
			<Param name="Interface" value="##SourceIPv4##"/>
			<Param name="Port" value="21"/>
      <Param name="AcceptTimeout" value="10000"/>
      <Param name="Timeout" value="5000"/>
		</Publisher>

    <!-- Used by server state for data port in active mode -->
    <Publisher name="DataPublisher" class="Tcp">
      <Param name="Host" value="##TargetIPv4##"/>
      <Param name="Port" value="##TargetPort##"/>
    </Publisher>

    <!-- Used by server state for data port in pasv mode -->
    <Publisher name="DataListner" class="TcpListener">
      <Param name="Interface" value="##SourceIPv4##"/>
      <Param name="Port" value="31337"/>
      <Param name="AcceptTimeout" value="10000"/>
    </Publisher>

		<Strategy class="##Strategy##"/>

		<Logger class="File" >
			<Param name="Path" value="##LoggerPath##"/>
		</Logger>
  </Test>
</Peach>
<!--END-->
