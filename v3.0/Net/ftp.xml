<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://peachfuzzer.com/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
			 xsi:schemaLocation="http://peachfuzzer.com/2012/Peach ../peach.xsd"
       author="Deja Vu Security, LLC" description="File  Protocol PIT" version="0.0.2">
  <!-- Copyright (c) Deja Vu Security, LLC 2013 -->
	
	<Include ns="FTP" src="file:##Path##/_Common/Models/Net/ftp_State.xml"/>

	<Agent name="WinRemoteAgent" location="tcp://##RemoteAgentIP##:9001">
		<Monitor class="WindowsDebugger">
      <Param name="Service" value="##ServiceName##" />
		</Monitor>
	</Agent>

	<Agent name="LinRemoteAgent" location="tcp://##RemoteAgentIP##:9001">
		<Monitor class="LinuxCrashMonitor"/>
	</Agent>

	<Agent name="OSXRemoteAgent" location="tcp://##RemoteAgentIP##:9001">
		<Monitor class="CrashReporter"/>
	</Agent>

	<Agent name="ServerAgent">
		<Monitor class="WindowsDebugger">
			<Param name="CommandLine" value="ftp 192.168.146.1"/>
			<Param name="NoCpuKill" value="true"/>
			<Param name="FaultOnEarlyExit" value="false"/>
			<Param name="WaitForExitTimeout" value="250"/>
			<Param name="StartOnCall" value="launchProgram"/>
			<Param name="WaitForExitOnCall" value="exitProgram"/>
		</Monitor>
	</Agent>

	<!-- Default test case -->
	<Test name="Default">
		<StateModel ref="FTP:AgentToHost"/>
		
		<!--Agent ref="WinRemoteAgent" platform="windows"/>
		<Agent ref="LinRemoteAgent" platform="linux"/>
		<Agent ref="OSXRemoteAgent" platform="osx"/-->

		<Publisher class="Tcp" name="TcpHandler">
			<Param name="Host" value="##TargetIPv4##"/>
			<Param name="Port" value="##TargetPort##"/>
		</Publisher>
		
		<Strategy class="##Strategy##"/>
		<Logger class="File" >
			<Param name="Path" value="##LoggerPath##"/>
		</Logger>	
	</Test>
	
	<!--Server side test-->
	<Test name="Server">
		<StateModel ref="FTP:HostToAgent"/>
		
		<Agent ref="ServerAgent"/>
		
		<Publisher name="TcpHandler" class="TcpListener">
			<Param name="Interface" value="##LocalIPv4##"/>
			<Param name="Port" value="21"/>
		</Publisher>
		
		<Strategy class="##Strategy##"/>
		
		<Logger class="File" >
			<Param name="Path" value="##LoggerPath##"/>
		</Logger>	
  </Test>
</Peach>
<!--END-->
