<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://phed.org/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
			 xsi:schemaLocation="http://phed.org/2012/Peach /peach/peach.xsd"  
       author="Deja Vu Security, LLC" description="Adress Resolution Protocol PIT" version="0.0.2">

  <!-- Copyright (c) Deja Vu Security, LLC 2012 -->
  <!-- Requires Linux Peach 3.0 and RawEther publisher -->

  <!-- Main data mdoe to send an ARP request -->
	<DataModel name="ARP">
		<Block name="EtherHeader">
			<Blob name="Dest" valueType="hex" value="ffffffffffff"/>
			<Blob name="Src" valueType="hex" value="##SourceMAC##"/>
			<Blob name="Type" token="true" valueType="hex" value="0806"/>
		</Block>
		<Block name="ARPPayload">
			<Number name="HTYPE" size="16" value="01" endian="big" signed="true"/>
			<Number name="PTYPE" size="16" valueType="hex" value="0800" endian="big" signed="true"/>
			<Number name="HLEN" size="8" >
	<Relation type="size" of="SHA"/>	
	<Relation type="size" of="THA"/>	
			</Number>
			<Number name="PLEN" size="8" >
	<Relation type="size" of="SPA"/> 
	<Relation type="size" of="TPA"/> 
			</Number>
			<Number name="OPER" size="16" value="1" endian="big"/>
			<Blob name="SHA" valueType="hex" value="##SourceMAC##"/>
			<Blob name="SPA" value="##SourceIPv4##">
				<Transformer class="Ipv4StringToNetworkOctet"/>
			</Blob>
			<Blob name="THA" valueType="hex" value="##TargetMAC##"/>
			<Blob name="TPA" value="##TargetIPv4##">
				<Transformer class="Ipv4StringToNetworkOctet"/>
			</Blob>
		</Block>
		<Blob name="Trailer"/>
	</DataModel>

	<Agent name="RemoteAgent" location="tcp://##RemoteAgent##:9001">
    <Monitor class="Process">
			<Param name="Executable" value="##tsharkBin##" />
			<Param name="Arguments" value="-i ##tsharkInterface##" />
      <Param name="RestartOnEachTest" value="true" />
			<Param name="FaultOnEarlyExit" value="true" />
		</Monitor>
		<Monitor class="Pcap">
			<Param name="Device" value="eth0" />
		</Monitor>
	</Agent>

	<Agent name="LocalAgent">
		<Monitor class="Pcap">
		 <Param name="Device" value="eth0" />
		</Monitor>
	</Agent>
		

  <!-- StateModel for All ARP requests  -->
	<StateModel name="TheState" initialState="Initial">
		<State name="Initial">
			<Action type="output">
        <DataModel ref="ARP"/>
			</Action>
		</State>
	</StateModel>

  <!-- Default test for fuzzing ARP -->
	<Test name="Default">
		<StateModel ref="TheState"/>
		<Agent ref="RemoteAgent"/>
		<Agent ref="LocalAgent"/>
		<Publisher class="RawEther">
			<Param name="Interface" value="##Interface##"/>
			<Param name="Protocol" value="ETH_P_ARP"/>
		</Publisher>
    
    <Logger class="logger.Filesystem" >
      <Param name="Path" value="##LoggerPath##" />
    </Logger>
	</Test>
</Peach>
