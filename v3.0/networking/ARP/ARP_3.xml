<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://phed.org/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
			 xsi:schemaLocation="http://phed.org/2012/Peach /peach/peach.xsd"  
       author="Deja Vu Security, LLC" description="Adress Resolution Protocol PIT" version="0.0.2">

  <!-- Copyright (c) Deja Vu Security, LLC 2012 -->
  <!-- Requires Linux Peach 3.0 and RawEther publisher -->

  <!-- Main data mdoe to send an ARP request -->
	<DataModel name="ARP">
		<Block name="EtherHeader">
			<Blob name="Dest" valueType="hex" value="ffffffffffff"/>
			<Blob name="Src" valueType="hex" value="##SourceMAC##"/>
			<Blob name="Type" token="true" valueType="hex" value="0806"/>
		</Block>
		<Block name="ARPPayload">
			<Number name="HTYPE" size="16" value="01" endian="big" signed="true"/>
			<Number name="PTYPE" size="16" valueType="hex" value="0800" endian="big" signed="true"/>
			<Number name="HLEN" size="8" >
	<Relation type="size" of="SHA"/>	
	<Relation type="size" of="THA"/>	
			</Number>
			<Number name="PLEN" size="8" >
	<Relation type="size" of="SPA"/> 
	<Relation type="size" of="TPA"/> 
			</Number>
			<Number name="OPER" size="16" value="1" endian="big"/>
			<Blob name="SHA"  length="6" valueType="hex" value="##SourceMAC##"/>
			<Block name="SPA">
				<Number name="SPA1"  size="8"  value="##SourceIP_PT1##"/>
				<Number name="SPA2"  size="8"  value="##SourceIP_PT2##"/>
				<Number name="SPA3"  size="8"  value="##SourceIP_PT3##"/>
				<Number name="SPA4"  size="8"  value="##SourceIP_PT4##"/>
			</Block>
			<Blob name="THA"  length="6" valueType="hex" value="##DestMAC##"/>
			<Block name="TPA">
				<Number name="TPA1"  size="8"  value="##TargetIP_PT1##"/>
				<Number name="TPA2"  size="8"  value="##TargetIP_PT2##"/>
				<Number name="TPA3"  size="8"  value="##TargetIP_PT3##"/>
				<Number name="TPA4"  size="8"  value="##TargetIP_PT4##"/>
			</Block>
		</Block>
		<Blob name="Trailer"/>
	</DataModel>

  <!-- StateModel for All ARP requests  -->
	<StateModel name="TheState" initialState="Initial">
		<State name="Initial">
			<Action type="output">
        <DataModel ref="ARP"/>
			</Action>
		</State>
	</StateModel>

  <!-- Default test for fuzzing ARP -->
	<Test name="Default">
		<StateModel ref="TheState"/>
		<Publisher class="RawEther">
			<Param name="Interface" value="##Interface##"/>
			<Param name="Protocol" value="ETH_P_ARP"/>
		</Publisher>
    
    <Logger class="logger.Filesystem" >
      <Param name="Path" value="##LoggerPath##" />
    </Logger>
	</Test>
</Peach>
