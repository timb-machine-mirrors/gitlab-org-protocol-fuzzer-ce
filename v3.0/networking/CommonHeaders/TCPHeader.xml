<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://peachfuzzer.com/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://peachfuzzer.com/2012/Peach ../peach.xsd"  
       author="Deja Vu Security, LLC" description="Transport Control Protocol PIT" version="0.0.2">
	<!-- Copyright (c) Deja Vu Security, LLC 2012 -->
	
	<!--### TargetIP and SourceIP must be added to the defines file, ex:

<Define key="TargetIP" value="127.0.0.1"/>
<Define key="SourceIP" value="127.0.0.1"/>

###-->

	<Include ns="Generic" src="file:##Path##/CommonHeaders/GenericDataTypes.xml"/>
	<Include ns="IPv4" src="file:##Path##/CommonHeaders/IPv4Header.xml"/>

	<DataModel name="OptionsAndPadding">
		<Padding name="PaddingValue" alignment="32">
			<Fixup class="FillValue">
				<Param name="ref" value="PaddingValue"/>
				<Param name="start" value="1"/>
				<Param name="stop" value="1"/>
			</Fixup>
		</Padding>
		<Choice name="Options" minOccurs="0">
			<Block name="EndOfOp">
				<Number value="0" name="TypeNumber"/>
			</Block>
			<Block name="Nop">
				<Number value="1" name="TypeNumber"/>
			</Block>
			<Block name="CC">  <!-- (obsolete) -->
				<Number value="11" name="TypeNumber"/>
			</Block>
			<Block name="CCNEW"> <!-- (obsolete) -->
				<Number value="12" name="TypeNumber"/>
			</Block>
			<Block name="CCECHO"> <!-- (obsolete) -->
				<Number value="13" name="TypeNumber"/>
			</Block>
			<Block name="Skeeter">
				<Number value="16" name="TypeNumber"/>
			</Block>
			<Block name="Bubba">
				<Number value="17" name="TypeNumber"/>
			</Block>
			<Block name="SCPSCapabilities">
				<Number value="20" name="TypeNumber"/>
			</Block>
			<Block name="SelectiveNegativeAcknowledgements">
				<Number value="21" name="TypeNumber"/>
			</Block>
			<Block name="RecordBoundaries">
				<Number value="22" name="TypeNumber"/>
			</Block>
			<Block name="Corruptionexperienced">
				<Number value="23" name="TypeNumber"/>
			</Block>
			<Block name="SNAP">
				<Number value="24" name="TypeNumber"/>
			</Block>
			<Block name="Unassigned">  <!-- (released 2000-12-18) -->
				<Number value="25" name="TypeNumber"/>
			</Block>
			<Block name="TCPCompressionFilter">
				<Number value="26" name="TypeNumber"/>
			</Block>
			<Block name="TCPAO"> <!-- TCP Authentication Option -->
				<Number value="29" name="TypeNumber"/>
			</Block>
			<Block name="MaximumSegmentSize" ref="Generic:SelfLenTLV">
				<Number name="Type" size="8" value="2"/>
				<Number name="Length" size="8" value="4"/>
				<Number name="Value" size="16"/>
			</Block>
			<Block name="WSOPT" ref="Generic:SelfLenTLV">  <!-- Window Scale -->
				<Number name="Type" size="8" value="3"/>
				<Number name="Length" size="8" value="3"/>
				<Block name="Value"/>
			</Block>
			<Block name="SACKPermitted" ref="Generic:SelfLenTLV">
				<Number name="Type" size="8" value="4"/>
				<Number name="Length" size="8" value="2"/>
				<Block name="Value"/>
			</Block>
			<Block name="SACK" ref="Generic:SelfLenTLV">
				<Number name="Type" size="8" value="5"/>
			</Block>
			<Block name="Echo" ref="Generic:SelfLenTLV">  <!-- (obsoleted by option 8) -->
				<Number name="Type" size="8" value="2"/>
				<Number name="Length" size="8" value="6"/>
				<Block name="Value"/>
			</Block>
			<Block name="EchoReply" ref="Generic:SelfLenTLV">  <!-- (obsoleted by option 8) -->
				<Number name="Type" size="8" value="2"/>
				<Number name="Length" size="8" value="7"/>
				<Block name="Value"/>
			</Block>
			<Block name="TSOPT" ref="Generic:SelfLenTLV">  <!-- Time Stamp Option -->
				<Number name="Type" size="8" value="8"/>
				<Number name="Length" size="8" value="10"/>
				<Block name="Value">
					<Number name="TimestampValue" size="32"/>
					<Number name="TimestampEchoReply" size="32"/>
				</Block>
			</Block>
			<Block name="PartialOrderConnectionPermitted" ref="Generic:SelfLenTLV">  <!-- (obsolete) -->
				<Number name="Type" size="8" value="9"/>
				<Number name="Length" size="8" value="2"/>
				<Block name="Value"/>
			</Block>
			<Block name="PartialOrderServiceProfile" ref="Generic:SelfLenTLV">  <!-- (obsolete) -->
				<Number name="Type" size="8" value="10"/>
				<Number name="Length" size="8" value="3"/>
				<Block name="Value"/>
			</Block>
			<Block name="TCPAlternateChecksumRequest" ref="Generic:SelfLenTLV"> <!-- (obsolete) -->
				<Number name="Type" size="8" value="14"/>
				<Number name="Length" size="8" value="3"/>
				<Block name="Value"/>
			</Block>
			<Block name="TCPAlternateChecksumData" ref="Generic:SelfLenTLV"> <!-- (obsolete) -->
				<Number name="Type" size="8" value="15"/>
			</Block>
			<Block name="TrailerChecksumOption" ref="Generic:SelfLenTLV">
				<Number name="Type" size="8" value="18"/>
				<Number name="Length" size="8" value="3"/>
				<Block name="Value"/>
			</Block>
			<Block name="MD5SignatureOption" ref="Generic:SelfLenTLV">  <!-- (obsoleted by option 29) -->
				<Number name="Type" size="8" value="19"/>
				<Number name="Length" size="8" value="18"/>
				<Block name="Value"/>
			</Block>
			<Block name="QuickStartResponse" ref="Generic:SelfLenTLV">
				<Number name="Type" size="8" value="27"/>
				<Number name="Length" size="8" value="8"/>
				<Block name="Value"/>
			</Block>
			<Block name="UserTimeoutOption" ref="Generic:SelfLenTLV">
				<Number name="Type" size="8" value="28"/>
				<Number name="Length" size="8" value="4"/>
				<Block name="Value"/>
			</Block>
			<Block name="MPTCP" ref="Generic:SelfLenTLV"> <!-- Multipath TCP -->
				<Number name="Type" size="8" value="30"/>
			</Block>
		</Choice>
		<!-- <Padding name="PaddingValue" alignment="32"/> -->
	</DataModel>

  <DataModel name="Packet">
		<Number name="SrcPort" size="16" endian="big" value="##SourcePort##"/>
		<Number name="DestPort" size="16" endian="big" value="##TargetPort##"/>
		<Number name="SequenceNumber" size="32" endian="big" valueType="hex" value="0043a577"/>
		<Number name="AcknowledgmentNumber" size="32" endian="big" value="0"/>
		<Flags name="DataOffset" size="4" endian="big">
			<Flag name="Offset" position="0" size="4" valueType="hex" value="f">
				<Relation type="size" of="Packet" expressionGet="size * 4" expressionSet="size / 4"/>
			</Flag>
		</Flags>
		<Flags name="ControlBits" size="12" endian="big">
			<Flag name="Reserved" position="0" size ="3"/>
			<Flag name="NS" position="3" size="1"/>
			<Flag name="CWR" position="4" size="1"/>
			<Flag name="ECE" position="5" size="1"/>
			<Flag name="URG" position="6" size="1"/>
			<Flag name="ACK" position="7" size="1"/>
			<Flag name="PSH" position="8" size="1"/>
			<Flag name="RST" position="9" size="1"/>
			<Flag name="SYN" position="10" size="1"/>
			<Flag name="FIN" position="11" size="1"/>
		</Flags>
		<Number name="WindowSize" size="16" endian="big" valueType="hex" value="aaaa"/>
		<Number name="CheckSum" size="16" endian="big">
      <Fixup class="TCPChecksumFixup">
        <Param name="ref" value="Packet" />
        <Param name="src" value="##TargetIP##" />
        <Param name="dst" value="##SourceIP##" />
      </Fixup>
    </Number>
		<Number name="UrgentPointer" size="16" endian="big"/>
		<Block name="OptionsAndPadding" ref="OptionsAndPadding" />
		<Block name="TcpPayload"/>
  </DataModel>

 	<Data name="SYN">
		<Field name="ControlBits.SYN" value="1"/>
	</Data>

 	<Data name="SYNACK">
		<Field name="ControlBits.SYN" value="1"/>
		<Field name="ControlBits.ACK" value="1"/>
	</Data>

 	<Data name="ACK">
		<Field name="ControlBits.ACK" value="1"/>
	</Data>

	<DataModel name="PacketWithData" ref="Packet">
		<Blob name="TcpPayload" value="this is a test packet\r\n"/>
	</DataModel>

 	<Data name="PSHACK">
		<Field name="ControlBits.ACK" value="1"/>
		<Field name="ControlBits.PSH" value="1"/>
	</Data>

 	<Data name="FINACK">
		<Field name="ControlBits.FIN" value="1"/>
		<Field name="ControlBits.ACK" value="1"/>
	</Data>

 	<Data name="FIN">
		<Field name="ControlBits.FIN" value="1"/>
	</Data>

	<DataModel name="InIPv4Packet" ref="IPv4:IPv4Header">
		<Number name="Header.Protocol" size="8" endian="big" valueType="hex" value="06"/>
		<Blob name="Header.SrcIP" length="4"/>
		<Blob name="Header.DestIP" length="4"/>
		<Block name="IPv4Payload" ref="Packet"/>
	</DataModel>

</Peach>
<!-- end -->
