<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://phed.org/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
			 xsi:schemaLocation="http://phed.org/2012/Peach /peach/peach.xsd"  
       author="Deja Vu Security, LLC" description="Adress Resolution Protocol PIT" version="0.0.2">

  <!-- Copyright (c) Deja Vu Security, LLC 2012 -->
  <!-- Requires Linux Peach 3.0 and RawEther publisher -->

  <!-- Main data mdoe to send an ARP request -->
	<DataModel name="LACP">
		<Block name="EtherHeader">
			<Blob name="Dest" valueType="hex" value="ffffffffffff"/>
			<Blob name="Src" valueType="hex" value="##SourceMAC##"/>
			<Blob name="Type" valueType="hex" value="8809"/>
		</Block>
		<Block name="LACPHeader">
			<Blob name="Subtype" valueType="hex" value="01"/>
			<Blob name="Version" valueType="hex" value="01"/>
			<Block name="Actor">
				<Blob name="Info" valueType="hex" value="01"/>
				<Number name="Length" size="8">
					<Relation type="size" of="Actor"/>
				</Number>
				<Blob name="SysPriority" valueType="hex" value="91f4"/>
				<Blob name="Sys" valueType="hex" value="##SourceMAC##"/>
				<Blob name="Key" valueType="hex" value="8000"/>
				<Blob name="PortPriority" valueType="hex" value="0000"/>
				<Blob name="Port" valueType="hex" value="0012"/>
				<Blob name="State" valueType="hex"  value="47"/>
				<Blob name="Reserved" valueType="hex" value="000000"/>
			</Block>
			<Block name="Partner">
				<Blob name="Info" valueType="hex" value="02"/>
				<Number name="Length" size="8">
					<Relation type="size" of="Partner"/>
				</Number>
				<Blob name="SysPriority" valueType="hex" value="0000"/>
				<Blob name="Sys" valueType="hex" value="##DestMAC##"/>
				<Blob name="Key" valueType="hex" value="0000"/>
				<Blob name="PortPriority" valueType="hex" value="0000"/>
				<Blob name="Port" valueType="hex" value="0000"/>
				<Blob name="State" valueType="hex"  value="3b"/>
				<Blob name="Reserved" valueType="hex" value="000000"/>
			</Block>
			<Block name="Collector">
				<Blob name="Info" valueType="hex" value="03"/>
				<Number name="Length" size="8">
					<Relation type="size" of="Collector"/>
				</Number>
				<Blob name="MaxDelay" valueType="hex" value="0002"/>
				<Blob name="Reserved" valueType="hex" length="12" />
			</Block>
			<Blob name="TermInfo" valueType="hex" value="00"/>
			<Number name="TermLength" size="8" value="0" />
			<Blob name="Reserved" valueType="hex" length="50"/>
		</Block>
		
		
		
		
		
		
		
		
		<Block name="VLAN_TCI">
			<Flags size="16">
				<Flag name="Priority"  position="0" size="3"/> 
				<Flag name="CFI"  position="3" size="1" value="0"/> 
				<Flag name="VID"  position="4" size="12"/> 
			</Flags>
		</Block>
		<Block name="Payload">
			<Blob name="Type" valueType="hex" value="0800" />
			<Blob name="Payload" valueType="hex" value="450000211d9e0000801106ef0a0001220a00011e00000000000dc5c248656c6c6f"/>
			<Number name="CRC" size="32" endian="big">
				<Fixup class="checksums.Crc32Fixup">
					<Param name="ref" value="VLAN"/>
				</Fixup>
			</Number>
		</Block>
	</DataModel>
	
	<DataModel name="VLANDoubleFrame">
		<Block name="EtherHeader">
			<Blob name="Dest" valueType="hex" value="ffffffffffff"/>
			<Blob name="Src" valueType="hex" value="##SourceMAC##"/>
			<Blob name="Type" token="true" valueType="hex" value="9100"/>
		</Block>
		<Block name="VLAN_TCI1">
			<Flags size="16">
				<Flag name="Priority"  position="0" size="3"/> 
				<Flag name="CFI"  position="3" size="1" value="0"/> 
				<Flag name="VID"  position="4" size="12"/> 
			</Flags>
		</Block>
		<Block name="VLAN_TCI2">
			<Blob name="Type" token="true" valueType="hex" value="8100"/>
			<Flags size="16">
				<Flag name="Priority"  position="0" size="3"/> 
				<Flag name="CFI"  position="3" size="1" value="0"/> 
				<Flag name="VID"  position="4" size="12"/> 
			</Flags>
		</Block>
		<Block name="Payload">
			<Blob name="Type" valueType="hex" value="0800" />
			<Blob name="Payload" valueType="hex" value="450000211d9e0000801106ef0a0001220a00011e00000000000dc5c248656c6c6f"/>
			<Number name="CRC" size="32" endian="big">
				<Fixup class="checksums.Crc32Fixup">
					<Param name="ref" value="VLANDoubleFrame"/>
				</Fixup>
			</Number>
		</Block>
	</DataModel>

  <!-- StateModel for All VLAN requests  -->
	<StateModel name="TheState" initialState="Initial">
		<State name="Initial">
			<Action type="output">
        <DataModel ref="##TestType##"/>
			</Action>
		</State>
	</StateModel>
	

  <!-- Default test for fuzzing VLAN -->
	<Test name="Default">
		<StateModel ref="TheState"/>
		<Publisher class="RawEther">
			<Param name="Interface" value="##Interface##"/>
			<Param name="Protocol" value="ETH_P_8021Q"/>
		</Publisher>
    
		<Logger class="logger.Filesystem" >
			<Param name="Path" value="##LoggerPath##" />
		</Logger>
	</Test>
</Peach>
