<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://peachfuzzer.com/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://peachfuzzer.com/2012/Peach D:/peach/peach.xsd"
       author="Deja Vu Security, LLC" description="Simple Network Management Protocol PIT" version="0.0.2">

  <!-- Copyright (c) Deja Vu Security, LLC 2012 -->
  
  <!--
      Simple Network Management Protocol v2c
      
      getRequest		- done
      getNextRequest	- done
      getBulkRequest	- done
  -->

<DataModel name="SNMPHeaderV2">
  
  <Blob name="SnmpType" value="30" valueType="hex" />
  <Number name="SnmpLen" size="8" >
    <Relation of="SnmpAll" type="size" />
  </Number>
  
  <Block name="SnmpAll">
    <Relation from="SnmpLen" type="size"/>
   
  <Number name="VersionType" value="2" size="8" />
    
  <Number name="VersionLength" value="1" size="8">
    <Relation of="Version" type="size"/>
  </Number>
    
    <Number name="Version" size="8" value="1">
      <Relation from="VersionLength" type="size"/>
    </Number>
  
	<Blob name="CommStringType" value="04" valueType="hex"/>  
  
	<Number name="CommStringLen" size="8"> 
		<Relation type="size" of="SnmpCommunity"/> 
	</Number>
  
	<String name="SnmpCommunity" value="##CommString##" nullTerminated="false"> 
		<Relation type="size" from="CommStringLen"/> 
	</String>
  
	<Blob name="RequestType"/>

    <Block name="PDU">

      <Number size="8" name="PDUSize">
        <Relation of="PDUData" type="size"/>
      </Number>

      <Block name="PDUData"/>
        <Relation type="size" from="PDUSize"/>
      </Block>
 </Block>
</DataModel>

  <!-- Simple Network Management Protocol: GetRequest data model... -->
  <DataModel name="SnmpGet" ref="SNMPHeaderV2">
   
    <Blob name="SnmpAll.RequestType" valueType="hex" value="a0" />
    
    <Block name="SnmpAll.PDU.PDUData">
      <Relation type="size" from="SnmpAll.PDU.PDUSize"/>
      
      <Block name="SnmpGetRequest">
        
        <Blob name="RequestIDTypeLen" valueType="hex" value="02" />
        
        <Number size="8" name="RequestIDLen" valueType="hex" value="04">
          <Relation of="RequestId" type="size"/>
        </Number>

        <Number name="RequestId" size="32" valueType="hex" value="72 a0 20 a6">
          <Relation from="RequestIDLen" type="size"/>
        </Number>

        <Blob name="SnmpErrorStatusType" valueType="hex" value="02"/>
        
        <Number size="8" name="SnmpErrorStatusLen" valueType="hex" value="01">
          <Relation of="SnmpErrorStatus" type="size"/>
        </Number>

        <Number name="SnmpErrorStatus" size="8" valueType="hex" value="00" signed="false">
          <Relation from="SnmpErrorStatusLen" type="size"/>
        </Number>
        
        <Blob name="SnmpErrorIndexTypeLen" valueType="hex" value="02 01" />
        <Number name="SnmpErrorIndex" size="8" valueType="hex" value="00" signed="false" />

        <Blob name="VariableBindingsType" valueType="hex" value="30"/>
        
        <Number name="VariableBindingsSize" valueType="hex" size="8">
          <Relation of="VariableBindings" type="size"/> 
        </Number> 
        
        <Block name="VariableBindings">
          <Relation from="VariableBindingsSize" type="size"/>
          <Block name="SnmpBinding" >
            <Blob name="SnmpVariable" valueType="hex" value="30" />
            <Number name="SnmpVariableLen" size="8">
              <Relation of="SnmpName" type="size" />
            </Number>
            <!-- Object Name: 1.3.6.1.2.1.1.4.0 (iso.3.6.1.2.1.1.4.0) -->
            <Blob name="SnmpName" valueType="hex" value="06 08 2b 06 01 02 01 01 04 00 05 00">
              <Relation from="SnmpVariableLen" type="size"  />
            </Blob> 
          </Block>
        </Block>
      </Block>
    </Block>
    
  </DataModel>
  
  <!-- Simple Network Management Protocol: GetNextRequest data model... -->
  <DataModel name="SnmpNext" ref="SNMPHeaderV2">
     <Blob name="SnmpAll.RequestType" valueType="hex" value="a1" />
    
    <Block name="SnmpAll.PDU.PDUData">
      <Relation type="size" from="SnmpAll.PDU.PDUSize"/>
      
      <Block name="SnmpGetRequest">
        
        <Blob name="RequestIDTypeLen" valueType="hex" value="02" />
        
        <Number size="8" name="RequestIDLen" valueType="hex" value="04">
          <Relation of="RequestId" type="size"/>
        </Number>

        <Number name="RequestId" size="32" valueType="hex" value="72 a0 20 a6">
          <Relation from="RequestIDLen" type="size"/>
        </Number>

        <Blob name="SnmpErrorStatusType" valueType="hex" value="02"/>
        
        <Number size="8" name="SnmpErrorStatusLen" valueType="hex" value="01">
          <Relation of="SnmpErrorStatus" type="size"/>
        </Number>

        <Number name="SnmpErrorStatus" size="8" valueType="hex" value="00" signed="false">
          <Relation from="SnmpErrorStatusLen" type="size"/>
        </Number>
        
        <Blob name="SnmpErrorIndexTypeLen" valueType="hex" value="02 01" />
        <Number name="SnmpErrorIndex" size="8" valueType="hex" value="00" signed="false" />

        <Blob name="VariableBindingsType" valueType="hex" value="30"/>
        
        <Number name="VariableBindingsSize" valueType="hex" size="8">
          <Relation of="VariableBindings" type="size"/> 
        </Number> 
        
        <Block name="VariableBindings">
          <Relation from="VariableBindingsSize" type="size"/>
          <Block name="SnmpBinding" >
            
            <Blob name="SnmpVariable" valueType="hex" value="30" />
            
            <Number name="SnmpVariableLen" size="8">
              <Relation of="SnmpName" type="size" />
            </Number>
            
            <!-- Object Name: 1.3.6.1.2.1.1.4.0 (iso.3.6.1.2.1.1.4.0) -->
            <Blob name="SnmpName" valueType="hex" value="06 09 2b 06 01 02 01 19 01 07 00 05 00">
              <Relation from="SnmpVariableLen" type="size"  />
            </Blob> 
          </Block>
        </Block>
      </Block>
    </Block>
  </DataModel>
  
  <!-- Simple Network Management Protocol: GetBulkRequest data model... -->
  <DataModel name="SnmpBulk" ref="SNMPHeaderV2">

     <Blob name="SnmpAll.RequestType" valueType="hex" value="a5" />
    
    <Block name="SnmpAll.PDU.PDUData">
      <Relation type="size" from="SnmpAll.PDU.PDUSize"/>
    
      <Block name="SnmpGetBulkRequest">
        <Blob name="RequestIDTypeLen" valueType="hex" value="02" />
        
        <Number size="8" name="RequestIDLen" valueType="hex" value="04">
          <Relation of="RequestId" type="size"/>
        </Number>

        <Number name="RequestId" size="32" valueType="hex" value="72 a0 20 a6">
          <Relation from="RequestIDLen" type="size"/>
        </Number>
        
        <Blob name="NonRepeatersPad" valueType="hex" value="02 01" />
        <Number name="NonRepeaters" size="8" value="0" />
        
        <Blob name="MaxRepetitionsTypeLen" valueType="hex" value="02 01" />
        <Number name="MaxRepetitions" size="8" valueType="hex" value="0a" signed="false" />
        
        <Blob name="SnmpVariableBindingsPad" valueType="hex" value="0000" />
        
        <Block name="VariableBindings">
          <Relation from="VariableBindingsSize" type="size"/>
          <Block name="SnmpBinding" >
            
            <Blob name="SnmpVariable" valueType="hex" value="30" />
            
            <Number name="SnmpVariableLen" size="8">
              <Relation of="SnmpName" type="size" />
            </Number>
            
            <!-- Object Name: 1.3.6.1.2.1.1.4.0 (iso.3.6.1.2.1.1.4.0) -->
            <Blob name="SnmpName" valueType="hex" value="06 09 2b 06 01 02 01 19 01 07 00 05 00">
              <Relation from="SnmpVariableLen" type="size"  />
            </Blob> 
          </Block>
        </Block>
      </Block>
    </Block>
  </DataModel>


        
  <!-- Agent conifuration to monitor for crashes -->
  <Agent name="TheAgent">
  </Agent> 
  
  <!-- NTP simple state model -->
  <StateModel name="ManagerToAgent" initialState="Initial">
    <State name="Initial">
      <!-- generate snmp get request packet -->
      <Action name="SnmpGetRequest" type="output" publisher="UdpHandler">
        <DataModel ref="SnmpGet" />
      </Action>
      
      <!-- generate snmp next request packet -->
      <Action name="SnmpGetNextRequest" type="output" publisher="UdpHandler">
        <DataModel ref="SnmpNext" />
      </Action>
      
      <!-- generate snmp bulk request packet -->
      <Action name="SnmpGetBulkRequest" type="output" publisher="UdpHandler">
        <DataModel ref="SnmpBulk" />
      </Action>
    </State>
  </StateModel>
  
  <!-- Default test case -->
  <Test name="Default">
    
    <StateModel ref="ManagerToAgent"/>
    
    <Agent ref="TheAgent" />
    
    <Publisher class="Udp" name="UdpHandler">
      <Param name="SrcPort" value="##SnmpSrcPort##" />
      <Param name="Host" value="##SnmpHost##" />
      <Param name="Port" value="##SnmpPort##" />
    </Publisher>
    
    <Strategy class="##Strategy##"/>
    <Logger class="logger.Filesystem" >
      <Param name="Path" value="##LoggerPath##" />
    </Logger>
    
  </Test>
  
</Peach>

