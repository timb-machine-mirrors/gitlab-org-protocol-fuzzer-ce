<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://peachfuzzer.com/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://peachfuzzer.com/2012/Peach ../peach.xsd"
       author="Deja Vu Security, LLC" description="Simple Network Management Protocol PIT" version="0.0.2">

  <!-- Copyright (c) Deja Vu Security, LLC 2012 -->

  <!--
	Simple Network Management Protocol v2c
	
	manager to agent...
	getRequest		- done
	getNextRequest	- done
	getBulkRequest	- done
	-->

	<!-- Simple Network Management Protocol: GetRequest data model... -->
	<DataModel name="SnmpGet">
		<Blob name="SnmpVersionPad" valueType="hex" value="00000000" />
		<Number name="SnmpVersion" size="8" valueType="hex" value="01" signed="false" />

		<Blob name="SnmpCommunityPad" valueType="hex" value="0000" />

		<!-- community: public -->
    <String name="SnmpCommunity" value="##CommString##"/> 

		<Block name="SnmpData">
			<!-- Found some extra bits... -->
			<Blob name="SnmpData" valueType="hex" value="a01a" />
			<Block name="SnmpGetRequest">
				<Blob name="SnmpRequestIdPad" valueType="hex" value="0000" />

				<!-- request-id: 30463 -->
				<Number name="SnmpRequestId" size="16" valueType="hex" value="76ff" signed="true" endian="big" />
				<Blob name="SnmpErrorStatusPad" valueType="hex" value="0000" />
				<Number name="SnmpErrorStatus" size="8" valueType="hex" value="00" signed="false" />
				<Blob name="SnmpErrorIndexPad" valueType="hex" value="0000" />

				<!-- error-index: 0 -->
				<Number name="SnmpErrorIndex" size="8" valueType="hex" value="00" signed="false" />
				<Blob name="SnmpVariableBindingsPad" valueType="hex" value="0000" />

				<Block name="SnmpVariableBindings">
					<Block name="SnmpBinding" >
						<Blob name="SnmpVariable" valueType="hex" value="300c0608" />
						<!-- Object Name: 1.3.6.1.2.1.1.4.0 (iso.3.6.1.2.1.1.4.0) -->
						<Blob name="SnmpName" valueType="hex" value="2b06010201010400" />
					</Block>
				</Block>
			</Block>
		</Block>
	</DataModel>

	<!-- Simple Network Management Protocol: GetNextRequest data model... -->	
	<DataModel name="SnmpNext">
		<Blob name="SnmpVersionPad" valueType="hex" value="00000000" />

		<!-- version: v2c (1) -->
		<Number name="SnmpVersion" size="8" valueType="hex" value="01" signed="false" />
		<Blob name="SnmpCommunityPad" valueType="hex" value="0000" />
		<!-- community: public -->
		<String name="SnmpCommunity" value="##CommString##" />

		<Block name="SnmpData">
			<Blob name="SnmpData" valueType="hex" value="a11b" />
			<Block name="SnmpGetNextRequest">
				<Blob name="SnmpRequestIdPad" valueType="hex" value="0000" />
				<!-- request-id: 8688 -->
				<Number name="SnmpRequestId" size="16" valueType="hex" value="21f0" signed="true" endian="big" />
				<Blob name="SnmpErrorStatusPad" valueType="hex" value="0000" />

				<!-- error-status: noError (0) -->
				<Number name="SnmpErrorStatus" size="8" valueType="hex" value="00" signed="false" />
				<Blob name="SnmpErrorIndexPad" valueType="hex" value="0000" />

				<!-- error-index: 0 -->
				<Number name="SnmpErrorIndex" size="8" valueType="hex" value="00" signed="false" />
				<Blob name="SnmpVariableBindingsPad" valueType="hex" value="0000" />
				<Block name="SnmpVariableBindings">
					<Block name="SnmpBinding" >
						<Blob name="SnmpVariable"  valueType="hex" value="300d0609" />
						<!-- Object Name: 1.3.6.1.2.1.25.1.7.0 (iso.3.6.1.2.1.25.1.7.0) -->
						<Blob name="SnmpName" valueType="hex" value="2b0601020119010700" />
					</Block>
				</Block>
			</Block>
		</Block>
	</DataModel>
	
	<!-- Simple Network Management Protocol: GetBulkRequest data model... -->
	<DataModel name="SnmpBulk">
		<Blob name="SnmpVersionPad" valueType="hex" value="00000000" />

		<!-- version: v2c (1) -->
		<Number name="SnmpVersion" size="8" valueType="hex" value="01" signed="false" />
		<Blob name="SnmpCommunityPad" valueType="hex" value="0000" />

		<!-- community: public -->
		<String name="SnmpCommunity" value="##CommString##" />
   
		<Block name="SnmpData">
			<Blob name="SnmpData" valueType="hex" value="a51c" />
			<Block name="SnmpGetBulkRequest">
				<Blob name="SnmpRequestIdPad" valueType="hex" value="0000" />
				<!-- request-id: 28174 -->
				<Number name="SnmpRequestId" size="16" valueType="hex" value="6e0e" signed="true" endian="big" />
				<Blob name="SnmpNonRepeatersPad" valueType="hex" value="0000" />
				<Number name="SnmpNonRepeaters" size="8" valueType="hex" value="00" signed="false" />
				<Blob name="SnmpMaxRepetitionsPad" valueType="hex" value="0000" />
				<!-- max-repetitions: 10 -->
				<Number name="SnmpMaxRepetitions" size="8" valueType="hex" value="0a" signed="false" />
				<Blob name="SnmpVariableBindingsPad" valueType="hex" value="0000" />

				<Block name="SnmpVariableBindings">
					<Block name="SnmpBinding" >
						<Blob name="SnmpVariable"  valueType="hex" value="300e060a" />
						<!-- Object Name: 1.3.6.1.2.1.1.9.1.4.6 (iso.3.6.1.2.1.1.9.1.4.6) -->
						<Blob name="SnmpName" valueType="hex" value="2b060102010109010406" />
					</Block>
				</Block>
			</Block>
		</Block>
	</DataModel>

  <!-- Agent conifuration to monitor for crashes -->
	<Agent name="TheAgent">
	</Agent> 
	
	<!-- NTP simple state model -->
	<StateModel name="ManagerToAgent" initialState="Initial">
		<State name="Initial">
		  <!-- generate snmp get request packet -->
		  <Action name="SnmpGetRequest" type="output" publisher="UdpHandler">
			  <DataModel ref="SnmpGet" />
		  </Action>
		
		  <!-- generate snmp next request packet -->
		  <Action name="SnmpGetNextRequest" type="output" publisher="UdpHandler">
			  <DataModel ref="SnmpNext" />
		  </Action>

		  <!-- generate snmp bulk request packet -->
		  <Action name="SnmpGetBulkRequest" type="output" publisher="UdpHandler">
			  <DataModel ref="SnmpBulk" />
		  </Action>

		  <!-- close udp socket -->
		  <Action type="close" publisher="UdpHandler" />
		</State>
	</StateModel>
	
	<!-- Default test case -->
	<Test name="Default">
		
		<StateModel ref="ManagerToAgent"/>
	
		<Agent ref="TheAgent" />
	
		<Publisher class="Udp" name="UdpHandler">
			<Param name="SrcPort" value="##SnmpSrcPort##" />
			<Param name="Host" value="##SnmpHost##" />
			<Param name="Port" value="##SnmpPort##" />
		</Publisher>
		
		<Logger class="logger.Filesystem" >
			<Param name="Path" value="##LoggerPath##" />
		</Logger>
	
	</Test>
	
</Peach>

