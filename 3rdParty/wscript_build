#!/usr/bin/env python

mapping = {
	'System.Data.SQLite.x86' : 'win_x86',
	'System.Data.SQLite.x64' : 'win_x64',
}

excludes = {
	# Microsoft scripting assemblies are included in IronPython
	'IronRuby' : '**/Microsoft.*.dll'
}

bld.read_nuget('packages.config', excl=excludes, mapping=mapping)

# Be.HexBox is not nugetable yet
bld.read_csshlib('Be.Windows.Forms.HexBox.dll', paths=['Be.HexEditor.150/bin'])

flexnet = 'flexnet_client-2016.08'

bld.read_csshlib('FlxClientCommon.dll', paths=[ flexnet ])
bld.read_csshlib('FlxLicensingClient.dll', paths=[ flexnet ])

#if bld.env.CS_NAME != 'csc':
#	bld.read_csshlib('System.Data.SQLite.dll', paths=#['System.Data.SQLite.Mono.1.0.109.0'])

nunit_tools = bld.path.find_node('NUnit.ConsoleRunner.3.8.0/tools')

bld(
	name='nunit-console',
	features = 'peach',
	install_path = '${BINDIR}',
	install_644 = {
		nunit_tools : nunit_tools.ant_glob('**/*'),
	}
)

if bld.env.BASENAME == 'web':
	subdirs = [
		'BouncyCastle/crypto',
		'BouncyCastle/crypto/test',
	]
else:
	subdirs = [
		'BouncyCastle/crypto',
		'BouncyCastle/crypto/test',
		'FlexNet.Operations-2016.R2',
		'Google.CityHash',
		'libusbdotnet',
		'Managed.AndroidDebugBridge',
		'PeakPcan',
		'pin',
		'Portable.Licensing',
		'Renci.SshNet',
		'Titanium-Web-Proxy/Titanium.Web.Proxy',
		'TotalPhase/aardvark',
		'TotalPhase/komodo',
		'VectorXL',
		'VMware-VIX-1.13.0-1295980',
	]

	if bld.env.CS_NAME != 'csc':
		subdirs.append('System.Data.SQLite-1.0.109.0')

	if bld.env.BASENAME == 'osx':
		bld(
			name='CrashWrangler',
			install_path = '${BINDIR}',
			install_644 = bld.path.ant_glob('CrashWrangler/**/*'),
		)

bld.recurse(subdirs)
