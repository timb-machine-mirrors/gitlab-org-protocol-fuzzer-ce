[[DebuggingPitFiles]]
== Debugging Pit Files

// * "-1 --debug"
// * --debug vs. --trace
// * How to read debug output
// * Walk through example for WAV or other simple format
// * Debugging in more complex environments
// * Fault simulation
// * Debugging models vs. debugging environment automation

A PIT is NOT valid unless...

 * The first iteration is successful against the target
 * The target is isolated from other input. 
 * You can demonstrate the target has parsed your data by checking if:
 ** GUI opening the image data
 ** Network service logs your data 
 ** Correct response packet from the target for the packet you sent
 ** The status lights blink appropriately
 * Logging is enabled
 * Monitoring is enabled
 * Monitoring has been tested and fault on a demo/test fault 

=== What to do if the pit doesn't parse

----
Peach.exe -t pit_file.xml 
----

If a stack trace prints, record the stack trace where improper error handling is happening.
The pit doesn't run properly.
During the testing and building phase run the first iteration only. 

----
Peach.exe -1 pit_file.xml
----

Reduce the pit to basic parts in order make sure the 

. Test
.. References have the right names
. Log Path
.. Has a valid folder 
. Publisher
.. Can correctly talk to or output data
. Agent
.. Monitor setup is correct and had connectivity
. State Machine
.. References data and Models correctly
. DataModel

Add +--debug+ for more verbose output.

----
Peach.exe -1 --debug pit_file.xml
----

=== Debugging Peach

==== On a crash 

Windows use the debug build of Peach and capture the full trace. 

Linux 

----
mono --debug Peach.exe --debug Peach.exe pit_file.xml 
----

Look at the stack track and find the offending code.

Attempt to debug with the following.  

. Make sure peach is compiling in visual studio. 
. Update to the latest Peach git files
. Recompile peach in visual studio
. Reduce your pit until you isolate the part of the pit file that is causing the crash.
. Write a small test case pit of what is you believe is causing the crash.
.. The more specifically isolated the better. 
. Run the test pit in Visual studio 	
. Isolate the code that is causing the crash
.. Hover or add a watch to the variable to see what its current state is. 
. Set a break point on the line of code and walk back in the call stack Debug->Windows->Call Stack
. Single step as needed

Create a patch and test case then submit via a pull request on github. 

