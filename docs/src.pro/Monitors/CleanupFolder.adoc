<<<
[[Monitors_CleanupFolder]]
== CleanupFolder Monitor

The _CleanupFolder_ monitor removes from a specified directory the files created on a target during a fuzzing session. Cleanup occurs before every test iteration.

When beginning a fuzzing run, Peach creates a list of the contents of a specified directory. The list identifies the items that are exempt from the cleanup activity. Before each iteration, _CleanupFolder_ cleans so that the hard drives are not cluttered with temporary, recovery, or scratch files.

=== Parameters

_Required:_

Folder:: Folder to clean.

_Optional:_

None.

=== Examples

ifdef::peachug[]

.Remove contents of a folder +

==============================
This parameter example is from a setup that uses the CleanupFolder monitor to remove a fuzzed file created by the File publisher. The directory, clean2, is empty at the start of each fuzzing run. Before each iteration, the CleanupFolder monitor deletes all files from the specified folder. During each iteration, the File publisher creates a fuzzed file.

[cols="2,4" options="header",halign="center"] 
|==========================================================
|Parameter    |Value
|Folder   |C:\\cleanme
|==========================================================

The following image shows the output from a file fuzzing session that uses _CleanupFolder_. The session duration is 3 iterations.

.{nbsp}
image::{images}/Monitor_CleanupFolder2.png[]


The following image shows the output from a file fuzzing session that does _not_ use _CleanupFolder_, but is otherwise identical to the previous setup.

.{nbsp}
image::{images}/Monitor_CleanupFolder3.png[]


NOTE: The FilePerIteration publisher, that generates a new filename for each fuzzed file, produced the fuzzed output files for both of the previous images.
==============================

endif::peachug[]


ifndef::peachug[]

.Remove contents of a folder +

==============================
Run this example from the folder specified using the _folder_ parameter. 

During each iteration, the file +fuzzed.txt+ is created by the File publisher. At the end of each iteration, +fuzzed.txt+ is deleted by the CleanupFolder monitor.

[source,xml]
----
<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://peachfuzzer.com/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://peachfuzzer.com/2012/Peach peach.xsd">

  <DataModel name="TheDataModel">
    <Number size="32" signed="false" value="31337" />
  </DataModel>

  <StateModel name="State" initialState="Initial" >
    <State name="Initial">
      <Action type="output">
          <DataModel ref="TheDataModel"/>
      </Action>

      <Action type="output" publisher="FilePub">
          <DataModel ref="TheDataModel"/>
      </Action>

    </State>
  </StateModel>

  <Agent name="TheAgent">
    <Monitor class="CleanupFolder">
      <Param name="Folder" value="C:\\cleanme"/>
    </Monitor>
  </Agent>

  <Test name="Default">
    <StateModel ref="State"/>

    <Agent ref="TheAgent" />

    <Publisher class="ConsoleHex"/>

    <Publisher name="FilePub" class="File">
      <Param name="FileName" value="fuzzed.txt"/>
    </Publisher>

    <Logger class="File">
      <Param name="Path" value="logs"/>
    </Logger>
  </Test>
</Peach>
----

Output from this example.

----
>peach -1 --debug example.xml

[[ Peach Pro v3.0.0.0
[[ Copyright (c) Deja vu Security

[*] Test 'Default' starting with random seed 43073.
Peach.Core.Agent.Agent StartMonitor: Monitor CleanupFolder
Peach.Core.Agent.Agent SessionStarting: Monitor

[R1,-,-] Performing iteration
Peach.Core.Engine runTest: Performing recording iteration.
Peach.Core.Dom.Action Run: Adding action to controlRecordingActionsExecuted
Peach.Core.Dom.Action ActionType.Output
Peach.Core.Publishers.ConsolePublisher start()
Peach.Core.Publishers.ConsolePublisher open()
Peach.Core.Publishers.ConsolePublisher output(4 bytes)
00000000   69 7A 00 00                                        iz??
Peach.Core.Publishers.ConsolePublisher close()
Peach.Core.Engine runTest: context.config.singleIteration == true
Peach.Core.Publishers.ConsolePublisher stop()
Peach.Core.Agent.Agent SessionFinished: Monitor

[*] Test 'Default' finished.
----
==============================

endif::peachug[]
