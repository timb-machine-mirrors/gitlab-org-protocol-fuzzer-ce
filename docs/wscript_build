#!/usr/bin/env python

import os

doc = bld(
  name='peach-userguide-pdf', 
#  rule='cmd.exe /c docs\\build.bat',
#  source=bld.path.ant_glob('src.pro/**/*.adoc'),
  )

#doc.exec_command(cmd='build.bat')

nodes = bld.path.ant_glob('out.pro/webhelp/docs/**/*')
for node in nodes:
    # difference between basedir and given dir
    relfile = node.path_from(bld.path)[len('out.pro/webhelp/docs/'):]
    pos = relfile.rfind(os.sep)
    subpath = ''
    if pos > -1:
        subpath = relfile[:pos]
    # add difference of path to install dir
    install_dir = '${BINDIR}/docs/' + subpath
    bld.install_files(install_dir, node)
    
#doc.install_files(
#  '${BINDIR}/docs',
#  bld.path.ant_glob('out.pro/webhelp/docs/**'),
#  chmod=Utils.O644,
#  )

doc.install_as(
  '${BINDIR}/Peach_Professional.pdf',
  'out.pro/pdf/peach_professional.pdf',
  chmod=Utils.O644,
  )

"""
bld(
	features = 'asciidoc',
	source = bld.path.ant_glob('src/**/*.txt'),
	conf = bld.path.find_resource('website.conf'),
	path = bld.path.find_dir('src'),
	name='website',
	install_path='${DOCDIR}/website/',
	relative_trick = True,
)

bld(
	features = 'asciidoc',
	install=bld.path.ant_glob('css/**/*'),
	install_path='${DOCDIR}/website/',
)
"""
