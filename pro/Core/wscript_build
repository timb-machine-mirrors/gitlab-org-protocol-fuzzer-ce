#!/usr/bin/env python

deps = [
	'Aspose.Words.dll',
	'aardvark_net.dll',
	'BouncyCastle.Crypto.dll',
	'Dapper.dll',
	'Facades/System.Runtime.dll',
	'Facades/System.Threading.Tasks.dll',
	'FlxClientCommon.dll',
	'FlxLicensingClient.dll',
	'Ionic.Zip.dll',
	'IronPython.dll',
	'komodo_net.dll',
	'LibUsbDotNet.dll',
	'Managed.Adb.dll',
	'Microsoft.CSharp.dll',
	'Microsoft.Diagnostics.Runtime.dll',
	'Microsoft.Dynamic.dll',
	'Microsoft.Scripting.dll',
	'Microsoft.Scripting.Metadata.dll',
	'Mono.Posix.dll',
	'Newtonsoft.Json.dll',
	'NLog.dll',
	'Nustache.Core.dll',
	'PacketDotNet.dll',
	'Patterns.Logging.dll',
	'Peach.Core.dll',
	'Portable.Licensing.dll',
	'Renci.SshNet.dll',
	'SharpPcap.dll',
	'SharpSnmpLib.Full.dll',
	'SharpSnmpLib.Portable.dll',
	'SocketHttpListener.dll',
	'System.dll',
	'System.Configuration.dll',
	'System.Core.dll',
	'System.Data.dll',
	'System.Data.DataSetExtensions.dll',
	'System.Data.SQLite.dll',
	'System.Drawing.dll',
	'System.Management.dll',
	'System.Numerics.dll',
	'System.Runtime.Remoting.dll',
	'System.Runtime.Serialization.dll',
	'System.ServiceProcess.dll',
	'System.Threading.Tasks.Dataflow.dll',
	'System.Net.Http.dll',
	'System.Net.Http.Formatting.dll',
	'System.Web.dll',
	'System.Web.Services.dll',
	'System.Xml.dll',
	'Titanium.Web.Proxy.dll',
	'vtortola.WebSockets.dll',
	'vtortola.WebSockets.Rfc6455.dll',
	'websocket-sharp.dll',
]

top = bld.path.parent.parent
flexnet = 'flexnet_client-2016.03.0'

if bld.env.TARGET in ['win']:
	embed = 'Vix.dll'
else:
	embed = ''

asm = bld(
	features = 'cs',
	unsafe = True,
	use = deps,
	source = bld.path.ant_glob('**/*.cs'),
	resource = bld.path.ant_glob('Resources/**/* WebServices/Views/**/*'),
	embed = embed,
	ide_content = 'WebServices/Models/Model.cd',
	name = 'Peach.Pro.dll',
	namespace = 'Peach.Pro.Core',
	install_755 = {},
	install_644 = {
		top.find_or_declare('/'.join(['3rdParty', flexnet, bld.env.BASENAME])) :
		top.ant_glob('/'.join(['3rdParty', flexnet, bld.env.BASENAME, '**']))
	}
)

if 'win' in bld.env['supported_features']:
	deps.extend([
		'UIAutomationClient.dll',
		'UIAutomationTypes.dll',
	])
	root = bld.path.find_or_declare('OS/Windows')
	asm.install_755[root] = root.ant_glob('Debuggers/DebugEngine/*.dll')

if 'linux' in bld.env['supported_features']:
	root = bld.path.find_or_declare('OS/Linux')
	asm.install_755[root] = root.ant_glob('gdb/**/*')
