<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://peachfuzzer.com/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://peachfuzzer.com/2012/Peach /peach/peach.xsd"
       author="Deja Vu Security, LLC" description="Dynamic Host Configuration Protocol v4 PIT DataModels" version="0.0.2">
	<!-- Copyright (c) Deja Vu Security, LLC 2013 -->

	<Include ns="UDPv4" src="file:##PitLibraryPath##/_Common/Models/Net/UDPv4_Data.xml"/>
	<Include ns="IPv4" src="file:##PitLibraryPath##/_Common/Models/Net/IPv4_Data.xml"/>
	<Include ns="Ethernet" src="file:##PitLibraryPath##/_Common/Models/Net/Ethernet_Data.xml"/>

	<Defaults>
		<Number endian="big"/>
	</Defaults>

	<DataModel name="TLV">
		<Number name="Type" size="8"/>
		<Number name="Length" size="8">
			<Relation type="size" of="Value"/>
		</Number>
		<Block name="Value"/>
	</DataModel>

	<DataModel name="DHCP">
		<Number name="OpCode" size="8" value="1"/>
		<Number name="HardwareType" size="8" value="1"/>
		<Number name="HardwareAddrLength" size="8">
			<Relation type="size" of="ClientMacAndPadding.ClientBlock.ClientMacAddr1"/>
		</Number>
		<Number name="Hops" size="8" value="0"/>
		<Number name="TransactionId" size="32" value="0x01963ac8"/>
		<Number name="SecondsElapsed" size="16"  value="0"/>
		<Flags size="16">
			<Flag name="Broadcast" size="1" position="0"/>
		</Flags>
		<Blob name="ClientIPAddress" valueType="ipv4" length="4" value="##SourceIPv4##"/>
		<Blob name="YourIPAddress" valueType="ipv4" length="4" value="##SourceIPv4##"/>
		<Blob name="NextServerIPAddress" valueType="ipv4" length="4" value="##TargetIPv4##"/>
		<Blob name="RelayAgentIPAddress" valueType="ipv4" length="4" value="##TargetIPv4##"/>
		<Block name="ClientMacAndPadding">
			<Block name="ClientBlock">
				<Blob name="ClientMacAddr1" valueType="hex" value="##SourceMAC##"/>
			</Block>
			<Padding alignment="128"/>
		</Block>
		<Blob name="ServerName" length="64"/>
		<Blob name="BootFileName" length="128"/>
		<Blob name="MagicCookie" length="4" valueType="hex" value="63825363"/>
		<Block name="Options"/>
	</DataModel>

	<DataModel name="DhcpIPPacket" ref="Ethernet:Frame">
		<Block name="Payload" mutable="false" ref="IPv4:Packet"/>
	</DataModel>

	<DataModel name="UdpDhcp" ref="UDPv4:Packet"/>

	<DataModel name="DhcpUDPPacket" ref="DhcpIPPacket">
		<Block name="Payload.Payload" ref="UdpDhcp"/>
	</DataModel>

	<DataModel name="Discover" ref="DhcpUDPPacket">
		<Block name="Payload.Payload.UdpPayload" ref="DHCP">
			<Blob name="ClientIPAddress" valueType="ipv4" length="4" value="0.0.0.0"/>
			<Blob name="YourIPAddress" valueType="ipv4" length="4" value="0.0.0.0"/>
			<Blob name="NextServerIPAddress" valueType="ipv4" length="4" value="0.0.0.0"/>
			<Blob name="RelayAgentIPAddress" valueType="ipv4" length="4" value="0.0.0.0"/>
			<Block name="Options">
				<Block name="DhcpMessageType" ref="TLV">
					<Number name="Type" size="8" value="53"/>
					<Number name="Length" size="8">
						<Relation type="size" of="Value"/>
					</Number>
					<Number name="Value" size="8" value="1"/>
				</Block>
				<Block name="ClientIdentifier" ref="TLV">
					<Number name="Type" size="8" value="61"/>
					<Number name="Length" size="8">
						<Relation type="size" of="Value"/>
					</Number>
					<Block name="Value">
						<Number name="HardwareType" size="8" value="1"/>
						<Blob name="ClientMacAddress" valueType="hex" value="##SourceMAC##"/>
					</Block>
				</Block>
				<Block name="RequestedIPAddress" ref="TLV">
					<Number name="Type" size="8" value="50"/>
					<Number name="Length" size="8">
						<Relation type="size" of="Value"/>
					</Number>
					<Blob name="Value" valueType="ipv4" length="4" value="0.0.0.0"/>
				</Block>
				<Block name="ParameterRequestList" ref="TLV">
					<Number name="Type" size="8" value="55"/>
					<Number name="Length" size="8">
						<Relation type="size" of="Value"/>
					</Number>
					<Block name="Value">
						<Number name="SubnetMask" size="8" value="1"/>
						<Number name="Router" size="8" value="3"/>
						<Number name="DomainNameServer" size="8" value="6"/>
						<Number name="NetworkTimeProtocol" size="8" value="42"/>
					</Block>
				</Block>
				<Number name="End" size="8" value="255"/>
				<Padding alignment="128"/>
			</Block>
		</Block>
	</DataModel>

	<DataModel name="Request" ref="DhcpUDPPacket">
		<Block name="Payload.Payload.UdpPayload" ref="DHCP">
			<Blob name="ClientIPAddress" valueType="ipv4" length="4" value="0.0.0.0"/>
			<Blob name="YourIPAddress" valueType="ipv4" length="4" value="0.0.0.0"/>
			<Blob name="NextServerIPAddress" valueType="ipv4" length="4" value="0.0.0.0"/>
			<Blob name="RelayAgentIPAddress" valueType="ipv4" length="4" value="0.0.0.0"/>
			<Block name="Options">
				<Block name="DhcpMessageType" ref="TLV">
					<Number name="Type" size="8" value="53"/>
					<Number name="Length" size="8">
						<Relation type="size" of="Value"/>
					</Number>
					<Number name="Value" size="8" value="3"/>
				</Block>
				<Block name="ClientIdentifier" ref="TLV">
					<Number name="Type" size="8" value="61"/>
					<Number name="Length" size="8">
						<Relation type="size" of="Value"/>
					</Number>
					<Block name="Value">
						<Number name="HardwareType" size="8" value="1"/>
						<Blob name="ClientMacAddress" valueType="hex" value="##SourceMAC##"/>
					</Block>
				</Block>
				<Block name="RequestedIPAddress" ref="TLV">
					<Number name="Type" size="8" value="50"/>
					<Number name="Length" size="8">
						<Relation type="size" of="Value"/>
					</Number>
					<Blob name="Value" valueType="ipv4" length="4" value="0.0.0.0"/>
				</Block>
				<Block name="DhcpServerIdentifier" ref="TLV">
					<Number name="Type" size="8" value="54"/>
					<Number name="Length" size="8">
						<Relation type="size" of="Value"/>
					</Number>
					<Blob name="Value" valueType="ipv4" length="4" value="0.0.0.0"/>
				</Block>
				<Block name="ParameterRequestList" ref="TLV">
					<Number name="Type" size="8" value="55"/>
					<Number name="Length" size="8">
						<Relation type="size" of="Value"/>
					</Number>
					<Block name="Value">
						<Number name="SubnetMask" size="8" value="1"/>
						<Number name="Router" size="8" value="3"/>
						<Number name="DomainNameServer" size="8" value="6"/>
						<Number name="NetworkTimeProtocol" size="8" value="42"/>
					</Block>
				</Block>
				<Number name="End" size="8" value="255"/>
				<Padding alignment="128"/>
			</Block>
		</Block>
	</DataModel>

	<DataModel name="DhcpOptions">
		<Choice minOccurs="1" maxOccurs="-1">
			<Block name="DhcpMessageType" ref="TLV">
				<Number name="Type" size="8" token="true" value="53"/>
				<Number name="Length" size="8">
					<Relation type="size" of="Value"/>
				</Number>
				<Number name="Value" size="8" value="2"/>
			</Block>
			<Block name="SubnetMask" ref="TLV">
				<Number name="Type" size="8" token="true" value="1"/>
				<Number name="Length" size="8">
					<Relation type="size" of="Value"/>
				</Number>
				<Blob name="Value" valueType="ipv4" length="4" value="255.255.255.0"/>
			</Block>
			<Block name="RenewalTime" ref="TLV">
				<Number name="Type" size="8" token="true" value="58"/>
				<Number name="Length" size="8">
					<Relation type="size" of="Value"/>
				</Number>
				<Number name="Value" size="32" value="1800"/>
			</Block>
			<Block name="RebindingTime" ref="TLV">
				<Number name="Type" size="8" token="true" value="59"/>
				<Number name="Length" size="8">
					<Relation type="size" of="Value"/>
				</Number>
				<Number name="Value" size="32" value="3150"/>
			</Block>
			<Block name="IpAddressLeaseTime" ref="TLV">
				<Number name="Type" size="8" token="true" value="51"/>
				<Number name="Length" size="8">
					<Relation type="size" of="Value"/>
				</Number>
				<Number name="Value" size="32" value="3600"/>
			</Block>
			<Block name="DhcpServerIdentifier" ref="TLV">
				<Number name="Type" size="8" token="true" value="54"/>
				<Number name="Length" size="8">
					<Relation type="size" of="Value"/>
				</Number>
				<Blob name="Value" valueType="ipv4" length="4" value="##SourceIPv4##"/>
			</Block>
			<Block name="Router" ref="TLV">
				<Number name="Type" size="8" token="true" value="3"/>
				<Number name="Length" size="8">
					<Relation type="size" of="Value"/>
				</Number>
				<Blob name="Value" valueType="ipv4" length="4" value="##SourceIPv4##"/>
			</Block>
			<Block name="DomainNameServer" ref="TLV">
				<Number name="Type" size="8" token="true" value="6"/>
				<Number name="Length" size="8">
					<Relation type="size" of="Value"/>
				</Number>
				<Blob name="Value" valueType="ipv4" length="4" value="##SourceIPv4##"/>
			</Block>
			<Block name="ClientIdentifier" ref="TLV">
				<Number name="Type" size="8" token="true" value="61"/>
				<Number name="Length" size="8">
					<Relation type="size" of="Value"/>
				</Number>
				<Block name="Value">
					<Number name="HardwareType" size="8" value="1"/>
					<Blob name="ClientMacAddress" valueType="hex" value="##SourceMAC##"/>
				</Block>
			</Block>
			<Block name="RequestedIPAddress" ref="TLV">
				<Number name="Type" size="8" token="true" value="50"/>
				<Number name="Length" size="8">
					<Relation type="size" of="Value"/>
				</Number>
				<Blob name="Value" valueType="ipv4" length="4" value="0.0.0.0"/>
			</Block>
			<Block name="ParameterRequestList" ref="TLV">
				<Number name="Type" size="8" token="true" value="55"/>
				<Number name="Length" size="8">
					<Relation type="size" of="Value"/>
				</Number>
				<Block name="Value">
					<Number name="SubnetMask" size="8" value="1"/>
					<Number name="Router" size="8" value="3"/>
					<Number name="DomainNameServer" size="8" value="6"/>
					<Number name="NetworkTimeProtocol" size="8" value="42"/>
				</Block>
			</Block>
		</Choice>

		<Number name="End" size="8" value="255"/>
		<Padding alignment="128"/>
	</DataModel>

	<DataModel name="Response" ref="DhcpUDPPacket">
		<Block name="Payload.Payload.UdpPayload" ref="DHCP">
			<Number name="OpCode" size="8" token="true" value="2"/>
			<Blob name="ClientIPAddress" valueType="ipv4" length="4" value="0.0.0.0"/>
			<Blob name="YourIPAddress" valueType="ipv4" length="4" value="##TargetIPv4##"/>
			<Blob name="NextServerIPAddress" valueType="ipv4" length="4" value="##SourceIPv4##"/>
			<Blob name="RelayAgentIPAddress" valueType="ipv4" length="4" value="0.0.0.0"/>
			<Block name="ClientMacAndPadding">
				<Block name="ClientBlock">
					<Blob name="ClientMacAddr1" valueType="hex" value="##TargetMAC##"/>
				</Block>
				<Padding alignment="128"/>
			</Block>
			<Block name="Options" ref="DhcpOptions"/>
		</Block>
	</DataModel>

	<DataModel name="Offer" ref="Response">
		<Block name="Payload.Payload.UdpPayload.Options" ref="DhcpOptions"/>
	</DataModel>

	<DataModel name="Ack" ref="Response">
		<Blob name="Payload.Payload.UdpPayload.NextServerIPAddress" valueType="ipv4" length="4" value="0.0.0.0"/>
		<Block name="Payload.Payload.UdpPayload.Options" ref="DhcpOptions"/>
	</DataModel>

</Peach>
<!-- end -->