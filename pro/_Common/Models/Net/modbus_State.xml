<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://peachfuzzer.com/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://peachfuzzer.com/2012/Peach /peach/peach.xsd"
  author="Deja Vu Security, LLC" description="Modus PIT StateModels" version="0.0.1">

<Include ns="Modbus" src="file:##PitLibraryPath##/_Common/Models/Net/modbus_Data.xml"/>

  <StateModel name="RTUMode" initialState="Initial">
    <State name="Initial">
      <Action type="input" publisher="ModbusOverSerial">
          <DataModel ref="Modbus:CatchInput" />
      </Action>
      <Action type="output" publisher="ModbusOverSerial">
        <DataModel ref="Modbus:RTUFrameFormat"/>
        <Data>
          <Field name="CrcBlock.FunctionChoices.Function.ReadHoldingRegisters" value=""/>
        </Data>
        <Data>
          <Field name="CrcBlock.FunctionChoices.Function.WriteSingleRegister" value=""/>
        </Data>
      </Action>
    </State>
  </StateModel>

  <StateModel name="AsciiMode" initialState="Initial">
    <State name="Initial">
      <Action type="input" publisher="ModbusOverSerial">
          <DataModel ref="Modbus:CatchInput" />
      </Action>
      <Action type="output" publisher="ModbusOverSerial">
        <DataModel ref="Modbus:AsciiFrameFormat"/>
        <Data>
          <Field name="LrcBlock.Function" value="03"/>
        </Data>
        <Data>
          <Field name="LrcBlock.Function" value="06"/>
        </Data>
      </Action>
    </State>
  </StateModel>

  <StateModel name="OverTcp" initialState="Initial">
    <State name="Initial">
      <Action type="output" publisher="ModbusOverTcp">
        <DataModel ref="Modbus:TcpFrameFormat"/>
        <Data>
          <Field name="Remaining.FunctionChoices.Function.WriteSingleRegister" value=""/>
        </Data>
        <Data>
          <Field name="Remaining.FunctionChoices.Function.ReadHoldingRegisters" value=""/>
        </Data>
        <Data>
          <Field name="Remaining.FunctionChoices.Function.ReadInputRegisters" value=""/>
        </Data>
        <Data>
          <Field name="Remaining.FunctionChoices.Function.WriteMultipleRegisters" value=""/>
        </Data>
      </Action>
      <Action type="input" publisher="ModbusOverTcp">
          <DataModel ref="Modbus:CatchInput" />
      </Action>
    </State>
  </StateModel>
</Peach>
<!-- end -->
